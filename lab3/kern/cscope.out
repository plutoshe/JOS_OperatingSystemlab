cscope 15 $HOME/PlutoShe/Os/JOS_OperatingSystemlab/lab3/kern               0000087315
	@console.c

3 
	~<öc/x86.h
>

4 
	~<öc/memœyout.h
>

5 
	~<öc/kbdªg.h
>

6 
	~<öc/°rög.h
>

7 
	~<öc/as£π.h
>

9 
	~<kîn/c⁄sﬁe.h
>

11 
c⁄s_öå
((*
¥oc
)());

12 
	`c⁄s_putc
(
c
);

16 
	$dñay
()

18 
	`öb
(0x84);

19 
	`öb
(0x84);

20 
	`öb
(0x84);

21 
	`öb
(0x84);

22 
	}
}

26 
	#COM1
 0x3F8

	)

28 
	#COM_RX
 0

29 
	#COM_TX
 0

30 
	#COM_DLL
 0

31 
	#COM_DLM
 1

32 
	#COM_IER
 1

33 
	#COM_IER_RDI
 0x01

34 
	#COM_IIR
 2

35 
	#COM_FCR
 2

36 
	#COM_LCR
 3

37 
	#COM_LCR_DLAB
 0x80

38 
	#COM_LCR_WLEN8
 0x03

39 
	#COM_MCR
 4

40 
	#COM_MCR_RTS
 0x02

41 
	#COM_MCR_DTR
 0x01

42 
	#COM_MCR_OUT2
 0x08

43 
	#COM_LSR
 5

44 
	#COM_LSR_DATA
 0x01

45 
	#COM_LSR_TXRDY
 0x20

46 
	#COM_LSR_TSRE
 0x40

47 

	)

48 
boﬁ
 
	g£rül_exi°s
;

51 
	$£rül_¥oc_d©a
()

53 i‡(!(
	`öb
(
COM1
+
COM_LSR
Ë& 
COM_LSR_DATA
))

55  
	`öb
(
COM1
+
COM_RX
);

56 
	}
}

58 
	$£t_©åibuã_cﬁ‹
(
uöt16_t
 
back
, uöt16_à
f‹e
) {

59 
©åibuã_cﬁ‹
 = (
back
 << 12Ë| (
f‹e
 << 8);

60 
	}
}

63 
	$£rül_öå
()

65 i‡(
£rül_exi°s
)

66 
	`c⁄s_öå
(
£rül_¥oc_d©a
);

67 
	}
}

70 
	$£rül_putc
(
c
)

72 
i
;

74 
i
 = 0;

75 !(
	`öb
(
COM1
 + 
COM_LSR
Ë& 
COM_LSR_TXRDY
Ë&& 
i
 < 12800;

76 
i
++)

77 
	`dñay
();

79 
	`outb
(
COM1
 + 
COM_TX
, 
c
);

80 
	}
}

83 
	$£rül_öô
()

86 
	`outb
(
COM1
+
COM_FCR
, 0);

89 
	`outb
(
COM1
+
COM_LCR
, 
COM_LCR_DLAB
);

90 
	`outb
(
COM1
+
COM_DLL
, (
uöt8_t
) (115200 / 9600));

91 
	`outb
(
COM1
+
COM_DLM
, 0);

94 
	`outb
(
COM1
+
COM_LCR
, 
COM_LCR_WLEN8
 & ~
COM_LCR_DLAB
);

97 
	`outb
(
COM1
+
COM_MCR
, 0);

99 
	`outb
(
COM1
+
COM_IER
, 
COM_IER_RDI
);

103 
£rül_exi°s
 = (
	`öb
(
COM1
+
COM_LSR
) != 0xFF);

104 (Ë
	`öb
(
COM1
+
COM_IIR
);

105 (Ë
	`öb
(
COM1
+
COM_RX
);

107 
	}
}

116 
	$Õt_putc
(
c
)

118 
i
;

120 
i
 = 0; !(
	`öb
(0x378+1) & 0x80) && i < 12800; i++)

121 
	`dñay
();

122 
	`outb
(0x378+0, 
c
);

123 
	`outb
(0x378+2, 0x08|0x04|0x01);

124 
	`outb
(0x378+2, 0x08);

125 
	}
}

132 
	gaddr_6845
;

133 
uöt16_t
 *
	g¸t_buf
;

134 
uöt16_t
 
	g¸t_pos
;

137 
	$cga_öô
()

139 vﬁ©ûê
uöt16_t
 *
˝
;

140 
uöt16_t
 
was
;

141 
pos
;

143 
˝
 = (
uöt16_t
*Ë(
KERNBASE
 + 
CGA_BUF
);

144 
was
 = *
˝
;

145 *
˝
 = (
uöt16_t
) 0xA55A;

146 i‡(*
˝
 != 0xA55A) {

147 
˝
 = (
uöt16_t
*Ë(
KERNBASE
 + 
MONO_BUF
);

148 
addr_6845
 = 
MONO_BASE
;

150 *
˝
 = 
was
;

151 
addr_6845
 = 
CGA_BASE
;

155 
	`outb
(
addr_6845
, 14);

156 
pos
 = 
	`öb
(
addr_6845
 + 1) << 8;

157 
	`outb
(
addr_6845
, 15);

158 
pos
 |
	`öb
(
addr_6845
 + 1);

160 
¸t_buf
 = (
uöt16_t
*Ë
˝
;

161 
¸t_pos
 = 
pos
;

162 
	}
}

167 
	$cga_putc
(
c
)

170 
c
 = c + 
©åibuã_cﬁ‹
;

174 
c
 & 0xff) {

176 i‡(
¸t_pos
 > 0) {

177 
¸t_pos
--;

178 
¸t_buf
[
¸t_pos
] = (
c
 & ~0xff) | ' ';

182 
¸t_pos
 +
CRT_COLS
;

185 
¸t_pos
 -(¸t_po†% 
CRT_COLS
);

188 
	`c⁄s_putc
(' ');

189 
	`c⁄s_putc
(' ');

190 
	`c⁄s_putc
(' ');

191 
	`c⁄s_putc
(' ');

192 
	`c⁄s_putc
(' ');

195 
¸t_buf
[
¸t_pos
++] = 
c
;

200 i‡(
¸t_pos
 >
CRT_SIZE
) {

201 
i
;

203 
	`memmove
(
¸t_buf
, cπ_bu‡+ 
CRT_COLS
, (
CRT_SIZE
 - CRT_COLSË* (
uöt16_t
));

204 
i
 = 
CRT_SIZE
 - 
CRT_COLS
; i < CRT_SIZE; i++)

205 
¸t_buf
[
i
] = 0x0700 | ' ';

206 
¸t_pos
 -
CRT_COLS
;

210 
	`outb
(
addr_6845
, 14);

211 
	`outb
(
addr_6845
 + 1, 
¸t_pos
 >> 8);

212 
	`outb
(
addr_6845
, 15);

213 
	`outb
(
addr_6845
 + 1, 
¸t_pos
);

214 
	}
}

219 
	#NO
 0

	)

221 
	#SHIFT
 (1<<0)

	)

222 
	#CTL
 (1<<1)

	)

223 
	#ALT
 (1<<2)

	)

225 
	#CAPSLOCK
 (1<<3)

	)

226 
	#NUMLOCK
 (1<<4)

	)

227 
	#SCROLLLOCK
 (1<<5)

	)

229 
	#E0ESC
 (1<<6)

	)

231 
uöt8_t
 
	gshi·code
[256] =

233 [0x1D] = 
CTL
,

234 [0x2A] = 
SHIFT
,

235 [0x36] = 
SHIFT
,

236 [0x38] = 
ALT
,

237 [0x9D] = 
CTL
,

238 [0xB8] = 
ALT


241 
uöt8_t
 
	gtoggÀcode
[256] =

243 [0x3A] = 
CAPSLOCK
,

244 [0x45] = 
NUMLOCK
,

245 [0x46] = 
SCROLLLOCK


248 
uöt8_t
 
	gn‹mÆm≠
[256] =

250 
NO
, 0x1B, '1', '2', '3', '4', '5', '6',

253 'o', 'p', '[', ']', '\n', 
NO
, 'a', 's',

255 '\'', '`', 
NO
, '\\', 'z', 'x', 'c', 'v',

256 'b', 'n', 'm', ',', '.', '/', 
NO
, '*',

257 
NO
, ' ', NO, NO, NO, NO, NO, NO,

258 
NO
, NO, NO, NO, NO, NO, NO, '7',

260 '2', '3', '0', '.', 
NO
, NO, NO, NO,

261 [0xC7] = 
KEY_HOME
, [0x9C] = '\n' ,

262 [0xB5] = '/' , [0xC8] = 
KEY_UP
,

263 [0xC9] = 
KEY_PGUP
, [0xCB] = 
KEY_LF
,

264 [0xCD] = 
KEY_RT
, [0xCF] = 
KEY_END
,

265 [0xD0] = 
KEY_DN
, [0xD1] = 
KEY_PGDN
,

266 [0xD2] = 
KEY_INS
, [0xD3] = 
KEY_DEL


269 
uöt8_t
 
	gshi·m≠
[256] =

271 
NO
, 033, '!', '@', '#', '$', '%', '^',

274 'O', 'P', '{', '}', '\n', 
NO
, 'A', 'S',

276 '"', '~', 
NO
, '|', 'Z', 'X', 'C', 'V',

277 'B', 'N', 'M', '<', '>', '?', 
NO
, '*',

278 
NO
, ' ', NO, NO, NO, NO, NO, NO,

279 
NO
, NO, NO, NO, NO, NO, NO, '7',

281 '2', '3', '0', '.', 
NO
, NO, NO, NO,

282 [0xC7] = 
KEY_HOME
, [0x9C] = '\n' ,

283 [0xB5] = '/' , [0xC8] = 
KEY_UP
,

284 [0xC9] = 
KEY_PGUP
, [0xCB] = 
KEY_LF
,

285 [0xCD] = 
KEY_RT
, [0xCF] = 
KEY_END
,

286 [0xD0] = 
KEY_DN
, [0xD1] = 
KEY_PGDN
,

287 [0xD2] = 
KEY_INS
, [0xD3] = 
KEY_DEL


290 
	#C
(
x
Ë(x - '@')

	)

292 
uöt8_t
 
	g˘lm≠
[256] =

294 
NO
, NO, NO, NO, NO, NO, NO, NO,

295 
NO
, NO, NO, NO, NO, NO, NO, NO,

296 
C
('Q'), C('W'), C('E'), C('R'), C('T'), C('Y'), C('U'), C('I'),

297 
C
('O'), C('P'), 
NO
, NO, '\r', NO, C('A'), C('S'),

298 
C
('D'), C('F'), C('G'), C('H'), C('J'), C('K'), C('L'), 
NO
,

299 
NO
, NO, NO, 
C
('\\'), C('Z'), C('X'), C('C'), C('V'),

300 
C
('B'), C('N'), C('M'), 
NO
, NO, C('/'), NO, NO,

301 [0x97] = 
KEY_HOME
,

302 [0xB5] = 
C
('/'), [0xC8] = 
KEY_UP
,

303 [0xC9] = 
KEY_PGUP
, [0xCB] = 
KEY_LF
,

304 [0xCD] = 
KEY_RT
, [0xCF] = 
KEY_END
,

305 [0xD0] = 
KEY_DN
, [0xD1] = 
KEY_PGDN
,

306 [0xD2] = 
KEY_INS
, [0xD3] = 
KEY_DEL


309 
uöt8_t
 *
	gch¨code
[4] = {

310 
n‹mÆm≠
,

311 
shi·m≠
,

312 
˘lm≠
,

313 
˘lm≠


321 
	$kbd_¥oc_d©a
()

323 
c
;

324 
uöt8_t
 
d©a
;

325 
uöt32_t
 
shi·
;

327 i‡((
	`öb
(
KBSTATP
Ë& 
KBS_DIB
) == 0)

330 
d©a
 = 
	`öb
(
KBDATAP
);

332 i‡(
d©a
 == 0xE0) {

334 
shi·
 |
E0ESC
;

336 } i‡(
d©a
 & 0x80) {

338 
d©a
 = (
shi·
 & 
E0ESC
 ? data : data & 0x7F);

339 
shi·
 &~(
shi·code
[
d©a
] | 
E0ESC
);

341 } i‡(
shi·
 & 
E0ESC
) {

343 
d©a
 |= 0x80;

344 
shi·
 &~
E0ESC
;

347 
shi·
 |
shi·code
[
d©a
];

348 
shi·
 ^
toggÀcode
[
d©a
];

350 
c
 = 
ch¨code
[
shi·
 & (
CTL
 | 
SHIFT
)][
d©a
];

351 i‡(
shi·
 & 
CAPSLOCK
) {

352 i‡('a' <
c
 && c <= 'z')

353 
c
 += 'A' - 'a';

354 i‡('A' <
c
 && c <= 'Z')

355 
c
 += 'a' - 'A';

360 i‡(!(~
shi·
 & (
CTL
 | 
ALT
)Ë&& 
c
 =
KEY_DEL
) {

361 
	`˝rötf
("Rebooting!\n");

362 
	`outb
(0x92, 0x3);

365  
c
;

366 
	}
}

369 
	$kbd_öå
()

371 
	`c⁄s_öå
(
kbd_¥oc_d©a
);

372 
	}
}

375 
	$kbd_öô
()

377 
	}
}

386 
	#CONSBUFSIZE
 512

	)

389 
uöt8_t
 
	mbuf
[
CONSBUFSIZE
];

390 
uöt32_t
 
	mΩos
;

391 
uöt32_t
 
	mwpos
;

392 } 
	gc⁄s
;

397 
c⁄s_öå
((*
¥oc
)())

399 
c
;

401 (
c
 = (*
¥oc
)()) != -1) {

402 i‡(
c
 == 0)

404 
c⁄s
.
buf
[c⁄s.
wpos
++] = 
c
;

405 i‡(
c⁄s
.
wpos
 =
CONSBUFSIZE
)

406 
c⁄s
.
wpos
 = 0;

408 
	}
}

412 
	$c⁄s_gëc
()

414 
c
;

419 
	`£rül_öå
();

420 
	`kbd_öå
();

423 i‡(
c⁄s
.
Ωos
 !c⁄s.
wpos
) {

424 
c
 = 
c⁄s
.
buf
[c⁄s.
Ωos
++];

425 i‡(
c⁄s
.
Ωos
 =
CONSBUFSIZE
)

426 
c⁄s
.
Ωos
 = 0;

427  
c
;

430 
	}
}

434 
	$c⁄s_putc
(
c
)

436 
	`£rül_putc
(
c
);

437 
	`Õt_putc
(
c
);

438 
	`cga_putc
(
c
);

439 
	}
}

443 
	$c⁄s_öô
()

445 
	`cga_öô
();

446 
	`kbd_öô
();

447 
	`£rül_öô
();

449 i‡(!
£rül_exi°s
)

450 
	`˝rötf
("SerialÖort doesÇotÉxist!\n");

451 
	}
}

457 
	$˝utch¨
(
c
)

459 
	`c⁄s_putc
(
c
);

460 
	}
}

463 
	$gëch¨
()

465 
c
;

467 (
c
 = 
	`c⁄s_gëc
()) == 0)

469  
c
;

470 
	}
}

473 
	$isc⁄s
(
fdnum
)

477 
	}
}

	@console.h

3 #i‚de‡
_CONSOLE_H_


4 
	#_CONSOLE_H_


	)

5 #i‚de‡
JOS_KERNEL


9 
	~<öc/ty≥s.h
>

11 
	#MONO_BASE
 0x3B4

	)

12 
	#MONO_BUF
 0xB0000

	)

13 
	#CGA_BASE
 0x3D4

	)

14 
	#CGA_BUF
 0xB8000

	)

16 
	#CRT_ROWS
 25

	)

17 
	#CRT_COLS
 80

	)

18 
	#CRT_SIZE
 (
CRT_ROWS
 * 
CRT_COLS
)

	)

19 
uöt16_t
 
	g©åibuã_cﬁ‹
 = 0x0700;

20 
£t_©åibuã_cﬁ‹
(
uöt16_t
 
back
, uöt16_à
f‹e
);

21 
c⁄s_öô
();

22 
c⁄s_gëc
();

24 
kbd_öå
();

25 
£rül_öå
();

	@entrypgdir.c

1 
	~<öc/mmu.h
>

2 
	~<öc/memœyout.h
>

4 
±e_t
 
	gíåy_pgèbÀ
[
NPTENTRIES
];

20 
__©åibuã__
((
	$__Æig√d__
(
PGSIZE
)))

21 
pde_t
 
íåy_pgdú
[
NPDENTRIES
] = {

24 ((
uöçå_t
)
íåy_pgèbÀ
 - 
KERNBASE
Ë+ 
PTE_P
,

26 [
KERNBASE
>>
PDXSHIFT
]

27 ((
uöçå_t
)
íåy_pgèbÀ
 - 
KERNBASE
Ë+ 
PTE_P
 + 
PTE_W


28 
	}
};

32 
__©åibuã__
((
	$__Æig√d__
(
PGSIZE
)))

33 
±e_t
 
íåy_pgèbÀ
[
NPTENTRIES
] = {

34 0x000000 | 
PTE_P
 | 
PTE_W
,

35 0x001000 | 
PTE_P
 | 
PTE_W
,

36 0x002000 | 
PTE_P
 | 
PTE_W
,

37 0x003000 | 
PTE_P
 | 
PTE_W
,

38 0x004000 | 
PTE_P
 | 
PTE_W
,

39 0x005000 | 
PTE_P
 | 
PTE_W
,

40 0x006000 | 
PTE_P
 | 
PTE_W
,

41 0x007000 | 
PTE_P
 | 
PTE_W
,

42 0x008000 | 
PTE_P
 | 
PTE_W
,

43 0x009000 | 
PTE_P
 | 
PTE_W
,

44 0x00a000 | 
PTE_P
 | 
PTE_W
,

45 0x00b000 | 
PTE_P
 | 
PTE_W
,

46 0x00c000 | 
PTE_P
 | 
PTE_W
,

47 0x00d000 | 
PTE_P
 | 
PTE_W
,

48 0x00e000 | 
PTE_P
 | 
PTE_W
,

49 0x00f000 | 
PTE_P
 | 
PTE_W
,

50 0x010000 | 
PTE_P
 | 
PTE_W
,

51 0x011000 | 
PTE_P
 | 
PTE_W
,

52 0x012000 | 
PTE_P
 | 
PTE_W
,

53 0x013000 | 
PTE_P
 | 
PTE_W
,

54 0x014000 | 
PTE_P
 | 
PTE_W
,

55 0x015000 | 
PTE_P
 | 
PTE_W
,

56 0x016000 | 
PTE_P
 | 
PTE_W
,

57 0x017000 | 
PTE_P
 | 
PTE_W
,

58 0x018000 | 
PTE_P
 | 
PTE_W
,

59 0x019000 | 
PTE_P
 | 
PTE_W
,

60 0x01a000 | 
PTE_P
 | 
PTE_W
,

61 0x01b000 | 
PTE_P
 | 
PTE_W
,

62 0x01c000 | 
PTE_P
 | 
PTE_W
,

63 0x01d000 | 
PTE_P
 | 
PTE_W
,

64 0x01e000 | 
PTE_P
 | 
PTE_W
,

65 0x01f000 | 
PTE_P
 | 
PTE_W
,

66 0x020000 | 
PTE_P
 | 
PTE_W
,

67 0x021000 | 
PTE_P
 | 
PTE_W
,

68 0x022000 | 
PTE_P
 | 
PTE_W
,

69 0x023000 | 
PTE_P
 | 
PTE_W
,

70 0x024000 | 
PTE_P
 | 
PTE_W
,

71 0x025000 | 
PTE_P
 | 
PTE_W
,

72 0x026000 | 
PTE_P
 | 
PTE_W
,

73 0x027000 | 
PTE_P
 | 
PTE_W
,

74 0x028000 | 
PTE_P
 | 
PTE_W
,

75 0x029000 | 
PTE_P
 | 
PTE_W
,

76 0x02a000 | 
PTE_P
 | 
PTE_W
,

77 0x02b000 | 
PTE_P
 | 
PTE_W
,

78 0x02c000 | 
PTE_P
 | 
PTE_W
,

79 0x02d000 | 
PTE_P
 | 
PTE_W
,

80 0x02e000 | 
PTE_P
 | 
PTE_W
,

81 0x02f000 | 
PTE_P
 | 
PTE_W
,

82 0x030000 | 
PTE_P
 | 
PTE_W
,

83 0x031000 | 
PTE_P
 | 
PTE_W
,

84 0x032000 | 
PTE_P
 | 
PTE_W
,

85 0x033000 | 
PTE_P
 | 
PTE_W
,

86 0x034000 | 
PTE_P
 | 
PTE_W
,

87 0x035000 | 
PTE_P
 | 
PTE_W
,

88 0x036000 | 
PTE_P
 | 
PTE_W
,

89 0x037000 | 
PTE_P
 | 
PTE_W
,

90 0x038000 | 
PTE_P
 | 
PTE_W
,

91 0x039000 | 
PTE_P
 | 
PTE_W
,

92 0x03a000 | 
PTE_P
 | 
PTE_W
,

93 0x03b000 | 
PTE_P
 | 
PTE_W
,

94 0x03c000 | 
PTE_P
 | 
PTE_W
,

95 0x03d000 | 
PTE_P
 | 
PTE_W
,

96 0x03e000 | 
PTE_P
 | 
PTE_W
,

97 0x03f000 | 
PTE_P
 | 
PTE_W
,

98 0x040000 | 
PTE_P
 | 
PTE_W
,

99 0x041000 | 
PTE_P
 | 
PTE_W
,

100 0x042000 | 
PTE_P
 | 
PTE_W
,

101 0x043000 | 
PTE_P
 | 
PTE_W
,

102 0x044000 | 
PTE_P
 | 
PTE_W
,

103 0x045000 | 
PTE_P
 | 
PTE_W
,

104 0x046000 | 
PTE_P
 | 
PTE_W
,

105 0x047000 | 
PTE_P
 | 
PTE_W
,

106 0x048000 | 
PTE_P
 | 
PTE_W
,

107 0x049000 | 
PTE_P
 | 
PTE_W
,

108 0x04a000 | 
PTE_P
 | 
PTE_W
,

109 0x04b000 | 
PTE_P
 | 
PTE_W
,

110 0x04c000 | 
PTE_P
 | 
PTE_W
,

111 0x04d000 | 
PTE_P
 | 
PTE_W
,

112 0x04e000 | 
PTE_P
 | 
PTE_W
,

113 0x04f000 | 
PTE_P
 | 
PTE_W
,

114 0x050000 | 
PTE_P
 | 
PTE_W
,

115 0x051000 | 
PTE_P
 | 
PTE_W
,

116 0x052000 | 
PTE_P
 | 
PTE_W
,

117 0x053000 | 
PTE_P
 | 
PTE_W
,

118 0x054000 | 
PTE_P
 | 
PTE_W
,

119 0x055000 | 
PTE_P
 | 
PTE_W
,

120 0x056000 | 
PTE_P
 | 
PTE_W
,

121 0x057000 | 
PTE_P
 | 
PTE_W
,

122 0x058000 | 
PTE_P
 | 
PTE_W
,

123 0x059000 | 
PTE_P
 | 
PTE_W
,

124 0x05a000 | 
PTE_P
 | 
PTE_W
,

125 0x05b000 | 
PTE_P
 | 
PTE_W
,

126 0x05c000 | 
PTE_P
 | 
PTE_W
,

127 0x05d000 | 
PTE_P
 | 
PTE_W
,

128 0x05e000 | 
PTE_P
 | 
PTE_W
,

129 0x05f000 | 
PTE_P
 | 
PTE_W
,

130 0x060000 | 
PTE_P
 | 
PTE_W
,

131 0x061000 | 
PTE_P
 | 
PTE_W
,

132 0x062000 | 
PTE_P
 | 
PTE_W
,

133 0x063000 | 
PTE_P
 | 
PTE_W
,

134 0x064000 | 
PTE_P
 | 
PTE_W
,

135 0x065000 | 
PTE_P
 | 
PTE_W
,

136 0x066000 | 
PTE_P
 | 
PTE_W
,

137 0x067000 | 
PTE_P
 | 
PTE_W
,

138 0x068000 | 
PTE_P
 | 
PTE_W
,

139 0x069000 | 
PTE_P
 | 
PTE_W
,

140 0x06a000 | 
PTE_P
 | 
PTE_W
,

141 0x06b000 | 
PTE_P
 | 
PTE_W
,

142 0x06c000 | 
PTE_P
 | 
PTE_W
,

143 0x06d000 | 
PTE_P
 | 
PTE_W
,

144 0x06e000 | 
PTE_P
 | 
PTE_W
,

145 0x06f000 | 
PTE_P
 | 
PTE_W
,

146 0x070000 | 
PTE_P
 | 
PTE_W
,

147 0x071000 | 
PTE_P
 | 
PTE_W
,

148 0x072000 | 
PTE_P
 | 
PTE_W
,

149 0x073000 | 
PTE_P
 | 
PTE_W
,

150 0x074000 | 
PTE_P
 | 
PTE_W
,

151 0x075000 | 
PTE_P
 | 
PTE_W
,

152 0x076000 | 
PTE_P
 | 
PTE_W
,

153 0x077000 | 
PTE_P
 | 
PTE_W
,

154 0x078000 | 
PTE_P
 | 
PTE_W
,

155 0x079000 | 
PTE_P
 | 
PTE_W
,

156 0x07a000 | 
PTE_P
 | 
PTE_W
,

157 0x07b000 | 
PTE_P
 | 
PTE_W
,

158 0x07c000 | 
PTE_P
 | 
PTE_W
,

159 0x07d000 | 
PTE_P
 | 
PTE_W
,

160 0x07e000 | 
PTE_P
 | 
PTE_W
,

161 0x07f000 | 
PTE_P
 | 
PTE_W
,

162 0x080000 | 
PTE_P
 | 
PTE_W
,

163 0x081000 | 
PTE_P
 | 
PTE_W
,

164 0x082000 | 
PTE_P
 | 
PTE_W
,

165 0x083000 | 
PTE_P
 | 
PTE_W
,

166 0x084000 | 
PTE_P
 | 
PTE_W
,

167 0x085000 | 
PTE_P
 | 
PTE_W
,

168 0x086000 | 
PTE_P
 | 
PTE_W
,

169 0x087000 | 
PTE_P
 | 
PTE_W
,

170 0x088000 | 
PTE_P
 | 
PTE_W
,

171 0x089000 | 
PTE_P
 | 
PTE_W
,

172 0x08a000 | 
PTE_P
 | 
PTE_W
,

173 0x08b000 | 
PTE_P
 | 
PTE_W
,

174 0x08c000 | 
PTE_P
 | 
PTE_W
,

175 0x08d000 | 
PTE_P
 | 
PTE_W
,

176 0x08e000 | 
PTE_P
 | 
PTE_W
,

177 0x08f000 | 
PTE_P
 | 
PTE_W
,

178 0x090000 | 
PTE_P
 | 
PTE_W
,

179 0x091000 | 
PTE_P
 | 
PTE_W
,

180 0x092000 | 
PTE_P
 | 
PTE_W
,

181 0x093000 | 
PTE_P
 | 
PTE_W
,

182 0x094000 | 
PTE_P
 | 
PTE_W
,

183 0x095000 | 
PTE_P
 | 
PTE_W
,

184 0x096000 | 
PTE_P
 | 
PTE_W
,

185 0x097000 | 
PTE_P
 | 
PTE_W
,

186 0x098000 | 
PTE_P
 | 
PTE_W
,

187 0x099000 | 
PTE_P
 | 
PTE_W
,

188 0x09a000 | 
PTE_P
 | 
PTE_W
,

189 0x09b000 | 
PTE_P
 | 
PTE_W
,

190 0x09c000 | 
PTE_P
 | 
PTE_W
,

191 0x09d000 | 
PTE_P
 | 
PTE_W
,

192 0x09e000 | 
PTE_P
 | 
PTE_W
,

193 0x09f000 | 
PTE_P
 | 
PTE_W
,

194 0x0a0000 | 
PTE_P
 | 
PTE_W
,

195 0x0a1000 | 
PTE_P
 | 
PTE_W
,

196 0x0a2000 | 
PTE_P
 | 
PTE_W
,

197 0x0a3000 | 
PTE_P
 | 
PTE_W
,

198 0x0a4000 | 
PTE_P
 | 
PTE_W
,

199 0x0a5000 | 
PTE_P
 | 
PTE_W
,

200 0x0a6000 | 
PTE_P
 | 
PTE_W
,

201 0x0a7000 | 
PTE_P
 | 
PTE_W
,

202 0x0a8000 | 
PTE_P
 | 
PTE_W
,

203 0x0a9000 | 
PTE_P
 | 
PTE_W
,

204 0x0Ø000 | 
PTE_P
 | 
PTE_W
,

205 0x0ab000 | 
PTE_P
 | 
PTE_W
,

206 0x0ac000 | 
PTE_P
 | 
PTE_W
,

207 0x0ad000 | 
PTE_P
 | 
PTE_W
,

208 0x0´000 | 
PTE_P
 | 
PTE_W
,

209 0x0af000 | 
PTE_P
 | 
PTE_W
,

210 0x0b0000 | 
PTE_P
 | 
PTE_W
,

211 0x0b1000 | 
PTE_P
 | 
PTE_W
,

212 0x0b2000 | 
PTE_P
 | 
PTE_W
,

213 0x0b3000 | 
PTE_P
 | 
PTE_W
,

214 0x0b4000 | 
PTE_P
 | 
PTE_W
,

215 0x0b5000 | 
PTE_P
 | 
PTE_W
,

216 0x0b6000 | 
PTE_P
 | 
PTE_W
,

217 0x0b7000 | 
PTE_P
 | 
PTE_W
,

218 0x0b8000 | 
PTE_P
 | 
PTE_W
,

219 0x0b9000 | 
PTE_P
 | 
PTE_W
,

220 0x0ba000 | 
PTE_P
 | 
PTE_W
,

221 0x0bb000 | 
PTE_P
 | 
PTE_W
,

222 0x0bc000 | 
PTE_P
 | 
PTE_W
,

223 0x0bd000 | 
PTE_P
 | 
PTE_W
,

224 0x0be000 | 
PTE_P
 | 
PTE_W
,

225 0x0bf000 | 
PTE_P
 | 
PTE_W
,

226 0x0c0000 | 
PTE_P
 | 
PTE_W
,

227 0x0c1000 | 
PTE_P
 | 
PTE_W
,

228 0x0c2000 | 
PTE_P
 | 
PTE_W
,

229 0x0c3000 | 
PTE_P
 | 
PTE_W
,

230 0x0c4000 | 
PTE_P
 | 
PTE_W
,

231 0x0c5000 | 
PTE_P
 | 
PTE_W
,

232 0x0c6000 | 
PTE_P
 | 
PTE_W
,

233 0x0c7000 | 
PTE_P
 | 
PTE_W
,

234 0x0c8000 | 
PTE_P
 | 
PTE_W
,

235 0x0c9000 | 
PTE_P
 | 
PTE_W
,

236 0x0ˇ000 | 
PTE_P
 | 
PTE_W
,

237 0x0cb000 | 
PTE_P
 | 
PTE_W
,

238 0x0cc000 | 
PTE_P
 | 
PTE_W
,

239 0x0cd000 | 
PTE_P
 | 
PTE_W
,

240 0x0˚000 | 
PTE_P
 | 
PTE_W
,

241 0x0cf000 | 
PTE_P
 | 
PTE_W
,

242 0x0d0000 | 
PTE_P
 | 
PTE_W
,

243 0x0d1000 | 
PTE_P
 | 
PTE_W
,

244 0x0d2000 | 
PTE_P
 | 
PTE_W
,

245 0x0d3000 | 
PTE_P
 | 
PTE_W
,

246 0x0d4000 | 
PTE_P
 | 
PTE_W
,

247 0x0d5000 | 
PTE_P
 | 
PTE_W
,

248 0x0d6000 | 
PTE_P
 | 
PTE_W
,

249 0x0d7000 | 
PTE_P
 | 
PTE_W
,

250 0x0d8000 | 
PTE_P
 | 
PTE_W
,

251 0x0d9000 | 
PTE_P
 | 
PTE_W
,

252 0x0da000 | 
PTE_P
 | 
PTE_W
,

253 0x0db000 | 
PTE_P
 | 
PTE_W
,

254 0x0dc000 | 
PTE_P
 | 
PTE_W
,

255 0x0dd000 | 
PTE_P
 | 
PTE_W
,

256 0x0de000 | 
PTE_P
 | 
PTE_W
,

257 0x0df000 | 
PTE_P
 | 
PTE_W
,

258 0x0e0000 | 
PTE_P
 | 
PTE_W
,

259 0x0e1000 | 
PTE_P
 | 
PTE_W
,

260 0x0e2000 | 
PTE_P
 | 
PTE_W
,

261 0x0e3000 | 
PTE_P
 | 
PTE_W
,

262 0x0e4000 | 
PTE_P
 | 
PTE_W
,

263 0x0e5000 | 
PTE_P
 | 
PTE_W
,

264 0x0e6000 | 
PTE_P
 | 
PTE_W
,

265 0x0e7000 | 
PTE_P
 | 
PTE_W
,

266 0x0e8000 | 
PTE_P
 | 
PTE_W
,

267 0x0e9000 | 
PTE_P
 | 
PTE_W
,

268 0x0ó000 | 
PTE_P
 | 
PTE_W
,

269 0x0eb000 | 
PTE_P
 | 
PTE_W
,

270 0x0ec000 | 
PTE_P
 | 
PTE_W
,

271 0x0ed000 | 
PTE_P
 | 
PTE_W
,

272 0x0ì000 | 
PTE_P
 | 
PTE_W
,

273 0x0ef000 | 
PTE_P
 | 
PTE_W
,

274 0x0f0000 | 
PTE_P
 | 
PTE_W
,

275 0x0f1000 | 
PTE_P
 | 
PTE_W
,

276 0x0f2000 | 
PTE_P
 | 
PTE_W
,

277 0x0f3000 | 
PTE_P
 | 
PTE_W
,

278 0x0f4000 | 
PTE_P
 | 
PTE_W
,

279 0x0f5000 | 
PTE_P
 | 
PTE_W
,

280 0x0f6000 | 
PTE_P
 | 
PTE_W
,

281 0x0f7000 | 
PTE_P
 | 
PTE_W
,

282 0x0f8000 | 
PTE_P
 | 
PTE_W
,

283 0x0f9000 | 
PTE_P
 | 
PTE_W
,

284 0x0Á000 | 
PTE_P
 | 
PTE_W
,

285 0x0fb000 | 
PTE_P
 | 
PTE_W
,

286 0x0fc000 | 
PTE_P
 | 
PTE_W
,

287 0x0fd000 | 
PTE_P
 | 
PTE_W
,

288 0x0„000 | 
PTE_P
 | 
PTE_W
,

289 0x0ff000 | 
PTE_P
 | 
PTE_W
,

290 0x100000 | 
PTE_P
 | 
PTE_W
,

291 0x101000 | 
PTE_P
 | 
PTE_W
,

292 0x102000 | 
PTE_P
 | 
PTE_W
,

293 0x103000 | 
PTE_P
 | 
PTE_W
,

294 0x104000 | 
PTE_P
 | 
PTE_W
,

295 0x105000 | 
PTE_P
 | 
PTE_W
,

296 0x106000 | 
PTE_P
 | 
PTE_W
,

297 0x107000 | 
PTE_P
 | 
PTE_W
,

298 0x108000 | 
PTE_P
 | 
PTE_W
,

299 0x109000 | 
PTE_P
 | 
PTE_W
,

300 0x10a000 | 
PTE_P
 | 
PTE_W
,

301 0x10b000 | 
PTE_P
 | 
PTE_W
,

302 0x10c000 | 
PTE_P
 | 
PTE_W
,

303 0x10d000 | 
PTE_P
 | 
PTE_W
,

304 0x10e000 | 
PTE_P
 | 
PTE_W
,

305 0x10f000 | 
PTE_P
 | 
PTE_W
,

306 0x110000 | 
PTE_P
 | 
PTE_W
,

307 0x111000 | 
PTE_P
 | 
PTE_W
,

308 0x112000 | 
PTE_P
 | 
PTE_W
,

309 0x113000 | 
PTE_P
 | 
PTE_W
,

310 0x114000 | 
PTE_P
 | 
PTE_W
,

311 0x115000 | 
PTE_P
 | 
PTE_W
,

312 0x116000 | 
PTE_P
 | 
PTE_W
,

313 0x117000 | 
PTE_P
 | 
PTE_W
,

314 0x118000 | 
PTE_P
 | 
PTE_W
,

315 0x119000 | 
PTE_P
 | 
PTE_W
,

316 0x11a000 | 
PTE_P
 | 
PTE_W
,

317 0x11b000 | 
PTE_P
 | 
PTE_W
,

318 0x11c000 | 
PTE_P
 | 
PTE_W
,

319 0x11d000 | 
PTE_P
 | 
PTE_W
,

320 0x11e000 | 
PTE_P
 | 
PTE_W
,

321 0x11f000 | 
PTE_P
 | 
PTE_W
,

322 0x120000 | 
PTE_P
 | 
PTE_W
,

323 0x121000 | 
PTE_P
 | 
PTE_W
,

324 0x122000 | 
PTE_P
 | 
PTE_W
,

325 0x123000 | 
PTE_P
 | 
PTE_W
,

326 0x124000 | 
PTE_P
 | 
PTE_W
,

327 0x125000 | 
PTE_P
 | 
PTE_W
,

328 0x126000 | 
PTE_P
 | 
PTE_W
,

329 0x127000 | 
PTE_P
 | 
PTE_W
,

330 0x128000 | 
PTE_P
 | 
PTE_W
,

331 0x129000 | 
PTE_P
 | 
PTE_W
,

332 0x12a000 | 
PTE_P
 | 
PTE_W
,

333 0x12b000 | 
PTE_P
 | 
PTE_W
,

334 0x12c000 | 
PTE_P
 | 
PTE_W
,

335 0x12d000 | 
PTE_P
 | 
PTE_W
,

336 0x12e000 | 
PTE_P
 | 
PTE_W
,

337 0x12f000 | 
PTE_P
 | 
PTE_W
,

338 0x130000 | 
PTE_P
 | 
PTE_W
,

339 0x131000 | 
PTE_P
 | 
PTE_W
,

340 0x132000 | 
PTE_P
 | 
PTE_W
,

341 0x133000 | 
PTE_P
 | 
PTE_W
,

342 0x134000 | 
PTE_P
 | 
PTE_W
,

343 0x135000 | 
PTE_P
 | 
PTE_W
,

344 0x136000 | 
PTE_P
 | 
PTE_W
,

345 0x137000 | 
PTE_P
 | 
PTE_W
,

346 0x138000 | 
PTE_P
 | 
PTE_W
,

347 0x139000 | 
PTE_P
 | 
PTE_W
,

348 0x13a000 | 
PTE_P
 | 
PTE_W
,

349 0x13b000 | 
PTE_P
 | 
PTE_W
,

350 0x13c000 | 
PTE_P
 | 
PTE_W
,

351 0x13d000 | 
PTE_P
 | 
PTE_W
,

352 0x13e000 | 
PTE_P
 | 
PTE_W
,

353 0x13f000 | 
PTE_P
 | 
PTE_W
,

354 0x140000 | 
PTE_P
 | 
PTE_W
,

355 0x141000 | 
PTE_P
 | 
PTE_W
,

356 0x142000 | 
PTE_P
 | 
PTE_W
,

357 0x143000 | 
PTE_P
 | 
PTE_W
,

358 0x144000 | 
PTE_P
 | 
PTE_W
,

359 0x145000 | 
PTE_P
 | 
PTE_W
,

360 0x146000 | 
PTE_P
 | 
PTE_W
,

361 0x147000 | 
PTE_P
 | 
PTE_W
,

362 0x148000 | 
PTE_P
 | 
PTE_W
,

363 0x149000 | 
PTE_P
 | 
PTE_W
,

364 0x14a000 | 
PTE_P
 | 
PTE_W
,

365 0x14b000 | 
PTE_P
 | 
PTE_W
,

366 0x14c000 | 
PTE_P
 | 
PTE_W
,

367 0x14d000 | 
PTE_P
 | 
PTE_W
,

368 0x14e000 | 
PTE_P
 | 
PTE_W
,

369 0x14f000 | 
PTE_P
 | 
PTE_W
,

370 0x150000 | 
PTE_P
 | 
PTE_W
,

371 0x151000 | 
PTE_P
 | 
PTE_W
,

372 0x152000 | 
PTE_P
 | 
PTE_W
,

373 0x153000 | 
PTE_P
 | 
PTE_W
,

374 0x154000 | 
PTE_P
 | 
PTE_W
,

375 0x155000 | 
PTE_P
 | 
PTE_W
,

376 0x156000 | 
PTE_P
 | 
PTE_W
,

377 0x157000 | 
PTE_P
 | 
PTE_W
,

378 0x158000 | 
PTE_P
 | 
PTE_W
,

379 0x159000 | 
PTE_P
 | 
PTE_W
,

380 0x15a000 | 
PTE_P
 | 
PTE_W
,

381 0x15b000 | 
PTE_P
 | 
PTE_W
,

382 0x15c000 | 
PTE_P
 | 
PTE_W
,

383 0x15d000 | 
PTE_P
 | 
PTE_W
,

384 0x15e000 | 
PTE_P
 | 
PTE_W
,

385 0x15f000 | 
PTE_P
 | 
PTE_W
,

386 0x160000 | 
PTE_P
 | 
PTE_W
,

387 0x161000 | 
PTE_P
 | 
PTE_W
,

388 0x162000 | 
PTE_P
 | 
PTE_W
,

389 0x163000 | 
PTE_P
 | 
PTE_W
,

390 0x164000 | 
PTE_P
 | 
PTE_W
,

391 0x165000 | 
PTE_P
 | 
PTE_W
,

392 0x166000 | 
PTE_P
 | 
PTE_W
,

393 0x167000 | 
PTE_P
 | 
PTE_W
,

394 0x168000 | 
PTE_P
 | 
PTE_W
,

395 0x169000 | 
PTE_P
 | 
PTE_W
,

396 0x16a000 | 
PTE_P
 | 
PTE_W
,

397 0x16b000 | 
PTE_P
 | 
PTE_W
,

398 0x16c000 | 
PTE_P
 | 
PTE_W
,

399 0x16d000 | 
PTE_P
 | 
PTE_W
,

400 0x16e000 | 
PTE_P
 | 
PTE_W
,

401 0x16f000 | 
PTE_P
 | 
PTE_W
,

402 0x170000 | 
PTE_P
 | 
PTE_W
,

403 0x171000 | 
PTE_P
 | 
PTE_W
,

404 0x172000 | 
PTE_P
 | 
PTE_W
,

405 0x173000 | 
PTE_P
 | 
PTE_W
,

406 0x174000 | 
PTE_P
 | 
PTE_W
,

407 0x175000 | 
PTE_P
 | 
PTE_W
,

408 0x176000 | 
PTE_P
 | 
PTE_W
,

409 0x177000 | 
PTE_P
 | 
PTE_W
,

410 0x178000 | 
PTE_P
 | 
PTE_W
,

411 0x179000 | 
PTE_P
 | 
PTE_W
,

412 0x17a000 | 
PTE_P
 | 
PTE_W
,

413 0x17b000 | 
PTE_P
 | 
PTE_W
,

414 0x17c000 | 
PTE_P
 | 
PTE_W
,

415 0x17d000 | 
PTE_P
 | 
PTE_W
,

416 0x17e000 | 
PTE_P
 | 
PTE_W
,

417 0x17f000 | 
PTE_P
 | 
PTE_W
,

418 0x180000 | 
PTE_P
 | 
PTE_W
,

419 0x181000 | 
PTE_P
 | 
PTE_W
,

420 0x182000 | 
PTE_P
 | 
PTE_W
,

421 0x183000 | 
PTE_P
 | 
PTE_W
,

422 0x184000 | 
PTE_P
 | 
PTE_W
,

423 0x185000 | 
PTE_P
 | 
PTE_W
,

424 0x186000 | 
PTE_P
 | 
PTE_W
,

425 0x187000 | 
PTE_P
 | 
PTE_W
,

426 0x188000 | 
PTE_P
 | 
PTE_W
,

427 0x189000 | 
PTE_P
 | 
PTE_W
,

428 0x18a000 | 
PTE_P
 | 
PTE_W
,

429 0x18b000 | 
PTE_P
 | 
PTE_W
,

430 0x18c000 | 
PTE_P
 | 
PTE_W
,

431 0x18d000 | 
PTE_P
 | 
PTE_W
,

432 0x18e000 | 
PTE_P
 | 
PTE_W
,

433 0x18f000 | 
PTE_P
 | 
PTE_W
,

434 0x190000 | 
PTE_P
 | 
PTE_W
,

435 0x191000 | 
PTE_P
 | 
PTE_W
,

436 0x192000 | 
PTE_P
 | 
PTE_W
,

437 0x193000 | 
PTE_P
 | 
PTE_W
,

438 0x194000 | 
PTE_P
 | 
PTE_W
,

439 0x195000 | 
PTE_P
 | 
PTE_W
,

440 0x196000 | 
PTE_P
 | 
PTE_W
,

441 0x197000 | 
PTE_P
 | 
PTE_W
,

442 0x198000 | 
PTE_P
 | 
PTE_W
,

443 0x199000 | 
PTE_P
 | 
PTE_W
,

444 0x19a000 | 
PTE_P
 | 
PTE_W
,

445 0x19b000 | 
PTE_P
 | 
PTE_W
,

446 0x19c000 | 
PTE_P
 | 
PTE_W
,

447 0x19d000 | 
PTE_P
 | 
PTE_W
,

448 0x19e000 | 
PTE_P
 | 
PTE_W
,

449 0x19f000 | 
PTE_P
 | 
PTE_W
,

450 0x1a0000 | 
PTE_P
 | 
PTE_W
,

451 0x1a1000 | 
PTE_P
 | 
PTE_W
,

452 0x1a2000 | 
PTE_P
 | 
PTE_W
,

453 0x1a3000 | 
PTE_P
 | 
PTE_W
,

454 0x1a4000 | 
PTE_P
 | 
PTE_W
,

455 0x1a5000 | 
PTE_P
 | 
PTE_W
,

456 0x1a6000 | 
PTE_P
 | 
PTE_W
,

457 0x1a7000 | 
PTE_P
 | 
PTE_W
,

458 0x1a8000 | 
PTE_P
 | 
PTE_W
,

459 0x1a9000 | 
PTE_P
 | 
PTE_W
,

460 0x1Ø000 | 
PTE_P
 | 
PTE_W
,

461 0x1ab000 | 
PTE_P
 | 
PTE_W
,

462 0x1ac000 | 
PTE_P
 | 
PTE_W
,

463 0x1ad000 | 
PTE_P
 | 
PTE_W
,

464 0x1´000 | 
PTE_P
 | 
PTE_W
,

465 0x1af000 | 
PTE_P
 | 
PTE_W
,

466 0x1b0000 | 
PTE_P
 | 
PTE_W
,

467 0x1b1000 | 
PTE_P
 | 
PTE_W
,

468 0x1b2000 | 
PTE_P
 | 
PTE_W
,

469 0x1b3000 | 
PTE_P
 | 
PTE_W
,

470 0x1b4000 | 
PTE_P
 | 
PTE_W
,

471 0x1b5000 | 
PTE_P
 | 
PTE_W
,

472 0x1b6000 | 
PTE_P
 | 
PTE_W
,

473 0x1b7000 | 
PTE_P
 | 
PTE_W
,

474 0x1b8000 | 
PTE_P
 | 
PTE_W
,

475 0x1b9000 | 
PTE_P
 | 
PTE_W
,

476 0x1ba000 | 
PTE_P
 | 
PTE_W
,

477 0x1bb000 | 
PTE_P
 | 
PTE_W
,

478 0x1bc000 | 
PTE_P
 | 
PTE_W
,

479 0x1bd000 | 
PTE_P
 | 
PTE_W
,

480 0x1be000 | 
PTE_P
 | 
PTE_W
,

481 0x1bf000 | 
PTE_P
 | 
PTE_W
,

482 0x1c0000 | 
PTE_P
 | 
PTE_W
,

483 0x1c1000 | 
PTE_P
 | 
PTE_W
,

484 0x1c2000 | 
PTE_P
 | 
PTE_W
,

485 0x1c3000 | 
PTE_P
 | 
PTE_W
,

486 0x1c4000 | 
PTE_P
 | 
PTE_W
,

487 0x1c5000 | 
PTE_P
 | 
PTE_W
,

488 0x1c6000 | 
PTE_P
 | 
PTE_W
,

489 0x1c7000 | 
PTE_P
 | 
PTE_W
,

490 0x1c8000 | 
PTE_P
 | 
PTE_W
,

491 0x1c9000 | 
PTE_P
 | 
PTE_W
,

492 0x1ˇ000 | 
PTE_P
 | 
PTE_W
,

493 0x1cb000 | 
PTE_P
 | 
PTE_W
,

494 0x1cc000 | 
PTE_P
 | 
PTE_W
,

495 0x1cd000 | 
PTE_P
 | 
PTE_W
,

496 0x1˚000 | 
PTE_P
 | 
PTE_W
,

497 0x1cf000 | 
PTE_P
 | 
PTE_W
,

498 0x1d0000 | 
PTE_P
 | 
PTE_W
,

499 0x1d1000 | 
PTE_P
 | 
PTE_W
,

500 0x1d2000 | 
PTE_P
 | 
PTE_W
,

501 0x1d3000 | 
PTE_P
 | 
PTE_W
,

502 0x1d4000 | 
PTE_P
 | 
PTE_W
,

503 0x1d5000 | 
PTE_P
 | 
PTE_W
,

504 0x1d6000 | 
PTE_P
 | 
PTE_W
,

505 0x1d7000 | 
PTE_P
 | 
PTE_W
,

506 0x1d8000 | 
PTE_P
 | 
PTE_W
,

507 0x1d9000 | 
PTE_P
 | 
PTE_W
,

508 0x1da000 | 
PTE_P
 | 
PTE_W
,

509 0x1db000 | 
PTE_P
 | 
PTE_W
,

510 0x1dc000 | 
PTE_P
 | 
PTE_W
,

511 0x1dd000 | 
PTE_P
 | 
PTE_W
,

512 0x1de000 | 
PTE_P
 | 
PTE_W
,

513 0x1df000 | 
PTE_P
 | 
PTE_W
,

514 0x1e0000 | 
PTE_P
 | 
PTE_W
,

515 0x1e1000 | 
PTE_P
 | 
PTE_W
,

516 0x1e2000 | 
PTE_P
 | 
PTE_W
,

517 0x1e3000 | 
PTE_P
 | 
PTE_W
,

518 0x1e4000 | 
PTE_P
 | 
PTE_W
,

519 0x1e5000 | 
PTE_P
 | 
PTE_W
,

520 0x1e6000 | 
PTE_P
 | 
PTE_W
,

521 0x1e7000 | 
PTE_P
 | 
PTE_W
,

522 0x1e8000 | 
PTE_P
 | 
PTE_W
,

523 0x1e9000 | 
PTE_P
 | 
PTE_W
,

524 0x1ó000 | 
PTE_P
 | 
PTE_W
,

525 0x1eb000 | 
PTE_P
 | 
PTE_W
,

526 0x1ec000 | 
PTE_P
 | 
PTE_W
,

527 0x1ed000 | 
PTE_P
 | 
PTE_W
,

528 0x1ì000 | 
PTE_P
 | 
PTE_W
,

529 0x1ef000 | 
PTE_P
 | 
PTE_W
,

530 0x1f0000 | 
PTE_P
 | 
PTE_W
,

531 0x1f1000 | 
PTE_P
 | 
PTE_W
,

532 0x1f2000 | 
PTE_P
 | 
PTE_W
,

533 0x1f3000 | 
PTE_P
 | 
PTE_W
,

534 0x1f4000 | 
PTE_P
 | 
PTE_W
,

535 0x1f5000 | 
PTE_P
 | 
PTE_W
,

536 0x1f6000 | 
PTE_P
 | 
PTE_W
,

537 0x1f7000 | 
PTE_P
 | 
PTE_W
,

538 0x1f8000 | 
PTE_P
 | 
PTE_W
,

539 0x1f9000 | 
PTE_P
 | 
PTE_W
,

540 0x1Á000 | 
PTE_P
 | 
PTE_W
,

541 0x1fb000 | 
PTE_P
 | 
PTE_W
,

542 0x1fc000 | 
PTE_P
 | 
PTE_W
,

543 0x1fd000 | 
PTE_P
 | 
PTE_W
,

544 0x1„000 | 
PTE_P
 | 
PTE_W
,

545 0x1ff000 | 
PTE_P
 | 
PTE_W
,

546 0x200000 | 
PTE_P
 | 
PTE_W
,

547 0x201000 | 
PTE_P
 | 
PTE_W
,

548 0x202000 | 
PTE_P
 | 
PTE_W
,

549 0x203000 | 
PTE_P
 | 
PTE_W
,

550 0x204000 | 
PTE_P
 | 
PTE_W
,

551 0x205000 | 
PTE_P
 | 
PTE_W
,

552 0x206000 | 
PTE_P
 | 
PTE_W
,

553 0x207000 | 
PTE_P
 | 
PTE_W
,

554 0x208000 | 
PTE_P
 | 
PTE_W
,

555 0x209000 | 
PTE_P
 | 
PTE_W
,

556 0x20a000 | 
PTE_P
 | 
PTE_W
,

557 0x20b000 | 
PTE_P
 | 
PTE_W
,

558 0x20c000 | 
PTE_P
 | 
PTE_W
,

559 0x20d000 | 
PTE_P
 | 
PTE_W
,

560 0x20e000 | 
PTE_P
 | 
PTE_W
,

561 0x20f000 | 
PTE_P
 | 
PTE_W
,

562 0x210000 | 
PTE_P
 | 
PTE_W
,

563 0x211000 | 
PTE_P
 | 
PTE_W
,

564 0x212000 | 
PTE_P
 | 
PTE_W
,

565 0x213000 | 
PTE_P
 | 
PTE_W
,

566 0x214000 | 
PTE_P
 | 
PTE_W
,

567 0x215000 | 
PTE_P
 | 
PTE_W
,

568 0x216000 | 
PTE_P
 | 
PTE_W
,

569 0x217000 | 
PTE_P
 | 
PTE_W
,

570 0x218000 | 
PTE_P
 | 
PTE_W
,

571 0x219000 | 
PTE_P
 | 
PTE_W
,

572 0x21a000 | 
PTE_P
 | 
PTE_W
,

573 0x21b000 | 
PTE_P
 | 
PTE_W
,

574 0x21c000 | 
PTE_P
 | 
PTE_W
,

575 0x21d000 | 
PTE_P
 | 
PTE_W
,

576 0x21e000 | 
PTE_P
 | 
PTE_W
,

577 0x21f000 | 
PTE_P
 | 
PTE_W
,

578 0x220000 | 
PTE_P
 | 
PTE_W
,

579 0x221000 | 
PTE_P
 | 
PTE_W
,

580 0x222000 | 
PTE_P
 | 
PTE_W
,

581 0x223000 | 
PTE_P
 | 
PTE_W
,

582 0x224000 | 
PTE_P
 | 
PTE_W
,

583 0x225000 | 
PTE_P
 | 
PTE_W
,

584 0x226000 | 
PTE_P
 | 
PTE_W
,

585 0x227000 | 
PTE_P
 | 
PTE_W
,

586 0x228000 | 
PTE_P
 | 
PTE_W
,

587 0x229000 | 
PTE_P
 | 
PTE_W
,

588 0x22a000 | 
PTE_P
 | 
PTE_W
,

589 0x22b000 | 
PTE_P
 | 
PTE_W
,

590 0x22c000 | 
PTE_P
 | 
PTE_W
,

591 0x22d000 | 
PTE_P
 | 
PTE_W
,

592 0x22e000 | 
PTE_P
 | 
PTE_W
,

593 0x22f000 | 
PTE_P
 | 
PTE_W
,

594 0x230000 | 
PTE_P
 | 
PTE_W
,

595 0x231000 | 
PTE_P
 | 
PTE_W
,

596 0x232000 | 
PTE_P
 | 
PTE_W
,

597 0x233000 | 
PTE_P
 | 
PTE_W
,

598 0x234000 | 
PTE_P
 | 
PTE_W
,

599 0x235000 | 
PTE_P
 | 
PTE_W
,

600 0x236000 | 
PTE_P
 | 
PTE_W
,

601 0x237000 | 
PTE_P
 | 
PTE_W
,

602 0x238000 | 
PTE_P
 | 
PTE_W
,

603 0x239000 | 
PTE_P
 | 
PTE_W
,

604 0x23a000 | 
PTE_P
 | 
PTE_W
,

605 0x23b000 | 
PTE_P
 | 
PTE_W
,

606 0x23c000 | 
PTE_P
 | 
PTE_W
,

607 0x23d000 | 
PTE_P
 | 
PTE_W
,

608 0x23e000 | 
PTE_P
 | 
PTE_W
,

609 0x23f000 | 
PTE_P
 | 
PTE_W
,

610 0x240000 | 
PTE_P
 | 
PTE_W
,

611 0x241000 | 
PTE_P
 | 
PTE_W
,

612 0x242000 | 
PTE_P
 | 
PTE_W
,

613 0x243000 | 
PTE_P
 | 
PTE_W
,

614 0x244000 | 
PTE_P
 | 
PTE_W
,

615 0x245000 | 
PTE_P
 | 
PTE_W
,

616 0x246000 | 
PTE_P
 | 
PTE_W
,

617 0x247000 | 
PTE_P
 | 
PTE_W
,

618 0x248000 | 
PTE_P
 | 
PTE_W
,

619 0x249000 | 
PTE_P
 | 
PTE_W
,

620 0x24a000 | 
PTE_P
 | 
PTE_W
,

621 0x24b000 | 
PTE_P
 | 
PTE_W
,

622 0x24c000 | 
PTE_P
 | 
PTE_W
,

623 0x24d000 | 
PTE_P
 | 
PTE_W
,

624 0x24e000 | 
PTE_P
 | 
PTE_W
,

625 0x24f000 | 
PTE_P
 | 
PTE_W
,

626 0x250000 | 
PTE_P
 | 
PTE_W
,

627 0x251000 | 
PTE_P
 | 
PTE_W
,

628 0x252000 | 
PTE_P
 | 
PTE_W
,

629 0x253000 | 
PTE_P
 | 
PTE_W
,

630 0x254000 | 
PTE_P
 | 
PTE_W
,

631 0x255000 | 
PTE_P
 | 
PTE_W
,

632 0x256000 | 
PTE_P
 | 
PTE_W
,

633 0x257000 | 
PTE_P
 | 
PTE_W
,

634 0x258000 | 
PTE_P
 | 
PTE_W
,

635 0x259000 | 
PTE_P
 | 
PTE_W
,

636 0x25a000 | 
PTE_P
 | 
PTE_W
,

637 0x25b000 | 
PTE_P
 | 
PTE_W
,

638 0x25c000 | 
PTE_P
 | 
PTE_W
,

639 0x25d000 | 
PTE_P
 | 
PTE_W
,

640 0x25e000 | 
PTE_P
 | 
PTE_W
,

641 0x25f000 | 
PTE_P
 | 
PTE_W
,

642 0x260000 | 
PTE_P
 | 
PTE_W
,

643 0x261000 | 
PTE_P
 | 
PTE_W
,

644 0x262000 | 
PTE_P
 | 
PTE_W
,

645 0x263000 | 
PTE_P
 | 
PTE_W
,

646 0x264000 | 
PTE_P
 | 
PTE_W
,

647 0x265000 | 
PTE_P
 | 
PTE_W
,

648 0x266000 | 
PTE_P
 | 
PTE_W
,

649 0x267000 | 
PTE_P
 | 
PTE_W
,

650 0x268000 | 
PTE_P
 | 
PTE_W
,

651 0x269000 | 
PTE_P
 | 
PTE_W
,

652 0x26a000 | 
PTE_P
 | 
PTE_W
,

653 0x26b000 | 
PTE_P
 | 
PTE_W
,

654 0x26c000 | 
PTE_P
 | 
PTE_W
,

655 0x26d000 | 
PTE_P
 | 
PTE_W
,

656 0x26e000 | 
PTE_P
 | 
PTE_W
,

657 0x26f000 | 
PTE_P
 | 
PTE_W
,

658 0x270000 | 
PTE_P
 | 
PTE_W
,

659 0x271000 | 
PTE_P
 | 
PTE_W
,

660 0x272000 | 
PTE_P
 | 
PTE_W
,

661 0x273000 | 
PTE_P
 | 
PTE_W
,

662 0x274000 | 
PTE_P
 | 
PTE_W
,

663 0x275000 | 
PTE_P
 | 
PTE_W
,

664 0x276000 | 
PTE_P
 | 
PTE_W
,

665 0x277000 | 
PTE_P
 | 
PTE_W
,

666 0x278000 | 
PTE_P
 | 
PTE_W
,

667 0x279000 | 
PTE_P
 | 
PTE_W
,

668 0x27a000 | 
PTE_P
 | 
PTE_W
,

669 0x27b000 | 
PTE_P
 | 
PTE_W
,

670 0x27c000 | 
PTE_P
 | 
PTE_W
,

671 0x27d000 | 
PTE_P
 | 
PTE_W
,

672 0x27e000 | 
PTE_P
 | 
PTE_W
,

673 0x27f000 | 
PTE_P
 | 
PTE_W
,

674 0x280000 | 
PTE_P
 | 
PTE_W
,

675 0x281000 | 
PTE_P
 | 
PTE_W
,

676 0x282000 | 
PTE_P
 | 
PTE_W
,

677 0x283000 | 
PTE_P
 | 
PTE_W
,

678 0x284000 | 
PTE_P
 | 
PTE_W
,

679 0x285000 | 
PTE_P
 | 
PTE_W
,

680 0x286000 | 
PTE_P
 | 
PTE_W
,

681 0x287000 | 
PTE_P
 | 
PTE_W
,

682 0x288000 | 
PTE_P
 | 
PTE_W
,

683 0x289000 | 
PTE_P
 | 
PTE_W
,

684 0x28a000 | 
PTE_P
 | 
PTE_W
,

685 0x28b000 | 
PTE_P
 | 
PTE_W
,

686 0x28c000 | 
PTE_P
 | 
PTE_W
,

687 0x28d000 | 
PTE_P
 | 
PTE_W
,

688 0x28e000 | 
PTE_P
 | 
PTE_W
,

689 0x28f000 | 
PTE_P
 | 
PTE_W
,

690 0x290000 | 
PTE_P
 | 
PTE_W
,

691 0x291000 | 
PTE_P
 | 
PTE_W
,

692 0x292000 | 
PTE_P
 | 
PTE_W
,

693 0x293000 | 
PTE_P
 | 
PTE_W
,

694 0x294000 | 
PTE_P
 | 
PTE_W
,

695 0x295000 | 
PTE_P
 | 
PTE_W
,

696 0x296000 | 
PTE_P
 | 
PTE_W
,

697 0x297000 | 
PTE_P
 | 
PTE_W
,

698 0x298000 | 
PTE_P
 | 
PTE_W
,

699 0x299000 | 
PTE_P
 | 
PTE_W
,

700 0x29a000 | 
PTE_P
 | 
PTE_W
,

701 0x29b000 | 
PTE_P
 | 
PTE_W
,

702 0x29c000 | 
PTE_P
 | 
PTE_W
,

703 0x29d000 | 
PTE_P
 | 
PTE_W
,

704 0x29e000 | 
PTE_P
 | 
PTE_W
,

705 0x29f000 | 
PTE_P
 | 
PTE_W
,

706 0x2a0000 | 
PTE_P
 | 
PTE_W
,

707 0x2a1000 | 
PTE_P
 | 
PTE_W
,

708 0x2a2000 | 
PTE_P
 | 
PTE_W
,

709 0x2a3000 | 
PTE_P
 | 
PTE_W
,

710 0x2a4000 | 
PTE_P
 | 
PTE_W
,

711 0x2a5000 | 
PTE_P
 | 
PTE_W
,

712 0x2a6000 | 
PTE_P
 | 
PTE_W
,

713 0x2a7000 | 
PTE_P
 | 
PTE_W
,

714 0x2a8000 | 
PTE_P
 | 
PTE_W
,

715 0x2a9000 | 
PTE_P
 | 
PTE_W
,

716 0x2Ø000 | 
PTE_P
 | 
PTE_W
,

717 0x2ab000 | 
PTE_P
 | 
PTE_W
,

718 0x2ac000 | 
PTE_P
 | 
PTE_W
,

719 0x2ad000 | 
PTE_P
 | 
PTE_W
,

720 0x2´000 | 
PTE_P
 | 
PTE_W
,

721 0x2af000 | 
PTE_P
 | 
PTE_W
,

722 0x2b0000 | 
PTE_P
 | 
PTE_W
,

723 0x2b1000 | 
PTE_P
 | 
PTE_W
,

724 0x2b2000 | 
PTE_P
 | 
PTE_W
,

725 0x2b3000 | 
PTE_P
 | 
PTE_W
,

726 0x2b4000 | 
PTE_P
 | 
PTE_W
,

727 0x2b5000 | 
PTE_P
 | 
PTE_W
,

728 0x2b6000 | 
PTE_P
 | 
PTE_W
,

729 0x2b7000 | 
PTE_P
 | 
PTE_W
,

730 0x2b8000 | 
PTE_P
 | 
PTE_W
,

731 0x2b9000 | 
PTE_P
 | 
PTE_W
,

732 0x2ba000 | 
PTE_P
 | 
PTE_W
,

733 0x2bb000 | 
PTE_P
 | 
PTE_W
,

734 0x2bc000 | 
PTE_P
 | 
PTE_W
,

735 0x2bd000 | 
PTE_P
 | 
PTE_W
,

736 0x2be000 | 
PTE_P
 | 
PTE_W
,

737 0x2bf000 | 
PTE_P
 | 
PTE_W
,

738 0x2c0000 | 
PTE_P
 | 
PTE_W
,

739 0x2c1000 | 
PTE_P
 | 
PTE_W
,

740 0x2c2000 | 
PTE_P
 | 
PTE_W
,

741 0x2c3000 | 
PTE_P
 | 
PTE_W
,

742 0x2c4000 | 
PTE_P
 | 
PTE_W
,

743 0x2c5000 | 
PTE_P
 | 
PTE_W
,

744 0x2c6000 | 
PTE_P
 | 
PTE_W
,

745 0x2c7000 | 
PTE_P
 | 
PTE_W
,

746 0x2c8000 | 
PTE_P
 | 
PTE_W
,

747 0x2c9000 | 
PTE_P
 | 
PTE_W
,

748 0x2ˇ000 | 
PTE_P
 | 
PTE_W
,

749 0x2cb000 | 
PTE_P
 | 
PTE_W
,

750 0x2cc000 | 
PTE_P
 | 
PTE_W
,

751 0x2cd000 | 
PTE_P
 | 
PTE_W
,

752 0x2˚000 | 
PTE_P
 | 
PTE_W
,

753 0x2cf000 | 
PTE_P
 | 
PTE_W
,

754 0x2d0000 | 
PTE_P
 | 
PTE_W
,

755 0x2d1000 | 
PTE_P
 | 
PTE_W
,

756 0x2d2000 | 
PTE_P
 | 
PTE_W
,

757 0x2d3000 | 
PTE_P
 | 
PTE_W
,

758 0x2d4000 | 
PTE_P
 | 
PTE_W
,

759 0x2d5000 | 
PTE_P
 | 
PTE_W
,

760 0x2d6000 | 
PTE_P
 | 
PTE_W
,

761 0x2d7000 | 
PTE_P
 | 
PTE_W
,

762 0x2d8000 | 
PTE_P
 | 
PTE_W
,

763 0x2d9000 | 
PTE_P
 | 
PTE_W
,

764 0x2da000 | 
PTE_P
 | 
PTE_W
,

765 0x2db000 | 
PTE_P
 | 
PTE_W
,

766 0x2dc000 | 
PTE_P
 | 
PTE_W
,

767 0x2dd000 | 
PTE_P
 | 
PTE_W
,

768 0x2de000 | 
PTE_P
 | 
PTE_W
,

769 0x2df000 | 
PTE_P
 | 
PTE_W
,

770 0x2e0000 | 
PTE_P
 | 
PTE_W
,

771 0x2e1000 | 
PTE_P
 | 
PTE_W
,

772 0x2e2000 | 
PTE_P
 | 
PTE_W
,

773 0x2e3000 | 
PTE_P
 | 
PTE_W
,

774 0x2e4000 | 
PTE_P
 | 
PTE_W
,

775 0x2e5000 | 
PTE_P
 | 
PTE_W
,

776 0x2e6000 | 
PTE_P
 | 
PTE_W
,

777 0x2e7000 | 
PTE_P
 | 
PTE_W
,

778 0x2e8000 | 
PTE_P
 | 
PTE_W
,

779 0x2e9000 | 
PTE_P
 | 
PTE_W
,

780 0x2ó000 | 
PTE_P
 | 
PTE_W
,

781 0x2eb000 | 
PTE_P
 | 
PTE_W
,

782 0x2ec000 | 
PTE_P
 | 
PTE_W
,

783 0x2ed000 | 
PTE_P
 | 
PTE_W
,

784 0x2ì000 | 
PTE_P
 | 
PTE_W
,

785 0x2ef000 | 
PTE_P
 | 
PTE_W
,

786 0x2f0000 | 
PTE_P
 | 
PTE_W
,

787 0x2f1000 | 
PTE_P
 | 
PTE_W
,

788 0x2f2000 | 
PTE_P
 | 
PTE_W
,

789 0x2f3000 | 
PTE_P
 | 
PTE_W
,

790 0x2f4000 | 
PTE_P
 | 
PTE_W
,

791 0x2f5000 | 
PTE_P
 | 
PTE_W
,

792 0x2f6000 | 
PTE_P
 | 
PTE_W
,

793 0x2f7000 | 
PTE_P
 | 
PTE_W
,

794 0x2f8000 | 
PTE_P
 | 
PTE_W
,

795 0x2f9000 | 
PTE_P
 | 
PTE_W
,

796 0x2Á000 | 
PTE_P
 | 
PTE_W
,

797 0x2fb000 | 
PTE_P
 | 
PTE_W
,

798 0x2fc000 | 
PTE_P
 | 
PTE_W
,

799 0x2fd000 | 
PTE_P
 | 
PTE_W
,

800 0x2„000 | 
PTE_P
 | 
PTE_W
,

801 0x2ff000 | 
PTE_P
 | 
PTE_W
,

802 0x300000 | 
PTE_P
 | 
PTE_W
,

803 0x301000 | 
PTE_P
 | 
PTE_W
,

804 0x302000 | 
PTE_P
 | 
PTE_W
,

805 0x303000 | 
PTE_P
 | 
PTE_W
,

806 0x304000 | 
PTE_P
 | 
PTE_W
,

807 0x305000 | 
PTE_P
 | 
PTE_W
,

808 0x306000 | 
PTE_P
 | 
PTE_W
,

809 0x307000 | 
PTE_P
 | 
PTE_W
,

810 0x308000 | 
PTE_P
 | 
PTE_W
,

811 0x309000 | 
PTE_P
 | 
PTE_W
,

812 0x30a000 | 
PTE_P
 | 
PTE_W
,

813 0x30b000 | 
PTE_P
 | 
PTE_W
,

814 0x30c000 | 
PTE_P
 | 
PTE_W
,

815 0x30d000 | 
PTE_P
 | 
PTE_W
,

816 0x30e000 | 
PTE_P
 | 
PTE_W
,

817 0x30f000 | 
PTE_P
 | 
PTE_W
,

818 0x310000 | 
PTE_P
 | 
PTE_W
,

819 0x311000 | 
PTE_P
 | 
PTE_W
,

820 0x312000 | 
PTE_P
 | 
PTE_W
,

821 0x313000 | 
PTE_P
 | 
PTE_W
,

822 0x314000 | 
PTE_P
 | 
PTE_W
,

823 0x315000 | 
PTE_P
 | 
PTE_W
,

824 0x316000 | 
PTE_P
 | 
PTE_W
,

825 0x317000 | 
PTE_P
 | 
PTE_W
,

826 0x318000 | 
PTE_P
 | 
PTE_W
,

827 0x319000 | 
PTE_P
 | 
PTE_W
,

828 0x31a000 | 
PTE_P
 | 
PTE_W
,

829 0x31b000 | 
PTE_P
 | 
PTE_W
,

830 0x31c000 | 
PTE_P
 | 
PTE_W
,

831 0x31d000 | 
PTE_P
 | 
PTE_W
,

832 0x31e000 | 
PTE_P
 | 
PTE_W
,

833 0x31f000 | 
PTE_P
 | 
PTE_W
,

834 0x320000 | 
PTE_P
 | 
PTE_W
,

835 0x321000 | 
PTE_P
 | 
PTE_W
,

836 0x322000 | 
PTE_P
 | 
PTE_W
,

837 0x323000 | 
PTE_P
 | 
PTE_W
,

838 0x324000 | 
PTE_P
 | 
PTE_W
,

839 0x325000 | 
PTE_P
 | 
PTE_W
,

840 0x326000 | 
PTE_P
 | 
PTE_W
,

841 0x327000 | 
PTE_P
 | 
PTE_W
,

842 0x328000 | 
PTE_P
 | 
PTE_W
,

843 0x329000 | 
PTE_P
 | 
PTE_W
,

844 0x32a000 | 
PTE_P
 | 
PTE_W
,

845 0x32b000 | 
PTE_P
 | 
PTE_W
,

846 0x32c000 | 
PTE_P
 | 
PTE_W
,

847 0x32d000 | 
PTE_P
 | 
PTE_W
,

848 0x32e000 | 
PTE_P
 | 
PTE_W
,

849 0x32f000 | 
PTE_P
 | 
PTE_W
,

850 0x330000 | 
PTE_P
 | 
PTE_W
,

851 0x331000 | 
PTE_P
 | 
PTE_W
,

852 0x332000 | 
PTE_P
 | 
PTE_W
,

853 0x333000 | 
PTE_P
 | 
PTE_W
,

854 0x334000 | 
PTE_P
 | 
PTE_W
,

855 0x335000 | 
PTE_P
 | 
PTE_W
,

856 0x336000 | 
PTE_P
 | 
PTE_W
,

857 0x337000 | 
PTE_P
 | 
PTE_W
,

858 0x338000 | 
PTE_P
 | 
PTE_W
,

859 0x339000 | 
PTE_P
 | 
PTE_W
,

860 0x33a000 | 
PTE_P
 | 
PTE_W
,

861 0x33b000 | 
PTE_P
 | 
PTE_W
,

862 0x33c000 | 
PTE_P
 | 
PTE_W
,

863 0x33d000 | 
PTE_P
 | 
PTE_W
,

864 0x33e000 | 
PTE_P
 | 
PTE_W
,

865 0x33f000 | 
PTE_P
 | 
PTE_W
,

866 0x340000 | 
PTE_P
 | 
PTE_W
,

867 0x341000 | 
PTE_P
 | 
PTE_W
,

868 0x342000 | 
PTE_P
 | 
PTE_W
,

869 0x343000 | 
PTE_P
 | 
PTE_W
,

870 0x344000 | 
PTE_P
 | 
PTE_W
,

871 0x345000 | 
PTE_P
 | 
PTE_W
,

872 0x346000 | 
PTE_P
 | 
PTE_W
,

873 0x347000 | 
PTE_P
 | 
PTE_W
,

874 0x348000 | 
PTE_P
 | 
PTE_W
,

875 0x349000 | 
PTE_P
 | 
PTE_W
,

876 0x34a000 | 
PTE_P
 | 
PTE_W
,

877 0x34b000 | 
PTE_P
 | 
PTE_W
,

878 0x34c000 | 
PTE_P
 | 
PTE_W
,

879 0x34d000 | 
PTE_P
 | 
PTE_W
,

880 0x34e000 | 
PTE_P
 | 
PTE_W
,

881 0x34f000 | 
PTE_P
 | 
PTE_W
,

882 0x350000 | 
PTE_P
 | 
PTE_W
,

883 0x351000 | 
PTE_P
 | 
PTE_W
,

884 0x352000 | 
PTE_P
 | 
PTE_W
,

885 0x353000 | 
PTE_P
 | 
PTE_W
,

886 0x354000 | 
PTE_P
 | 
PTE_W
,

887 0x355000 | 
PTE_P
 | 
PTE_W
,

888 0x356000 | 
PTE_P
 | 
PTE_W
,

889 0x357000 | 
PTE_P
 | 
PTE_W
,

890 0x358000 | 
PTE_P
 | 
PTE_W
,

891 0x359000 | 
PTE_P
 | 
PTE_W
,

892 0x35a000 | 
PTE_P
 | 
PTE_W
,

893 0x35b000 | 
PTE_P
 | 
PTE_W
,

894 0x35c000 | 
PTE_P
 | 
PTE_W
,

895 0x35d000 | 
PTE_P
 | 
PTE_W
,

896 0x35e000 | 
PTE_P
 | 
PTE_W
,

897 0x35f000 | 
PTE_P
 | 
PTE_W
,

898 0x360000 | 
PTE_P
 | 
PTE_W
,

899 0x361000 | 
PTE_P
 | 
PTE_W
,

900 0x362000 | 
PTE_P
 | 
PTE_W
,

901 0x363000 | 
PTE_P
 | 
PTE_W
,

902 0x364000 | 
PTE_P
 | 
PTE_W
,

903 0x365000 | 
PTE_P
 | 
PTE_W
,

904 0x366000 | 
PTE_P
 | 
PTE_W
,

905 0x367000 | 
PTE_P
 | 
PTE_W
,

906 0x368000 | 
PTE_P
 | 
PTE_W
,

907 0x369000 | 
PTE_P
 | 
PTE_W
,

908 0x36a000 | 
PTE_P
 | 
PTE_W
,

909 0x36b000 | 
PTE_P
 | 
PTE_W
,

910 0x36c000 | 
PTE_P
 | 
PTE_W
,

911 0x36d000 | 
PTE_P
 | 
PTE_W
,

912 0x36e000 | 
PTE_P
 | 
PTE_W
,

913 0x36f000 | 
PTE_P
 | 
PTE_W
,

914 0x370000 | 
PTE_P
 | 
PTE_W
,

915 0x371000 | 
PTE_P
 | 
PTE_W
,

916 0x372000 | 
PTE_P
 | 
PTE_W
,

917 0x373000 | 
PTE_P
 | 
PTE_W
,

918 0x374000 | 
PTE_P
 | 
PTE_W
,

919 0x375000 | 
PTE_P
 | 
PTE_W
,

920 0x376000 | 
PTE_P
 | 
PTE_W
,

921 0x377000 | 
PTE_P
 | 
PTE_W
,

922 0x378000 | 
PTE_P
 | 
PTE_W
,

923 0x379000 | 
PTE_P
 | 
PTE_W
,

924 0x37a000 | 
PTE_P
 | 
PTE_W
,

925 0x37b000 | 
PTE_P
 | 
PTE_W
,

926 0x37c000 | 
PTE_P
 | 
PTE_W
,

927 0x37d000 | 
PTE_P
 | 
PTE_W
,

928 0x37e000 | 
PTE_P
 | 
PTE_W
,

929 0x37f000 | 
PTE_P
 | 
PTE_W
,

930 0x380000 | 
PTE_P
 | 
PTE_W
,

931 0x381000 | 
PTE_P
 | 
PTE_W
,

932 0x382000 | 
PTE_P
 | 
PTE_W
,

933 0x383000 | 
PTE_P
 | 
PTE_W
,

934 0x384000 | 
PTE_P
 | 
PTE_W
,

935 0x385000 | 
PTE_P
 | 
PTE_W
,

936 0x386000 | 
PTE_P
 | 
PTE_W
,

937 0x387000 | 
PTE_P
 | 
PTE_W
,

938 0x388000 | 
PTE_P
 | 
PTE_W
,

939 0x389000 | 
PTE_P
 | 
PTE_W
,

940 0x38a000 | 
PTE_P
 | 
PTE_W
,

941 0x38b000 | 
PTE_P
 | 
PTE_W
,

942 0x38c000 | 
PTE_P
 | 
PTE_W
,

943 0x38d000 | 
PTE_P
 | 
PTE_W
,

944 0x38e000 | 
PTE_P
 | 
PTE_W
,

945 0x38f000 | 
PTE_P
 | 
PTE_W
,

946 0x390000 | 
PTE_P
 | 
PTE_W
,

947 0x391000 | 
PTE_P
 | 
PTE_W
,

948 0x392000 | 
PTE_P
 | 
PTE_W
,

949 0x393000 | 
PTE_P
 | 
PTE_W
,

950 0x394000 | 
PTE_P
 | 
PTE_W
,

951 0x395000 | 
PTE_P
 | 
PTE_W
,

952 0x396000 | 
PTE_P
 | 
PTE_W
,

953 0x397000 | 
PTE_P
 | 
PTE_W
,

954 0x398000 | 
PTE_P
 | 
PTE_W
,

955 0x399000 | 
PTE_P
 | 
PTE_W
,

956 0x39a000 | 
PTE_P
 | 
PTE_W
,

957 0x39b000 | 
PTE_P
 | 
PTE_W
,

958 0x39c000 | 
PTE_P
 | 
PTE_W
,

959 0x39d000 | 
PTE_P
 | 
PTE_W
,

960 0x39e000 | 
PTE_P
 | 
PTE_W
,

961 0x39f000 | 
PTE_P
 | 
PTE_W
,

962 0x3a0000 | 
PTE_P
 | 
PTE_W
,

963 0x3a1000 | 
PTE_P
 | 
PTE_W
,

964 0x3a2000 | 
PTE_P
 | 
PTE_W
,

965 0x3a3000 | 
PTE_P
 | 
PTE_W
,

966 0x3a4000 | 
PTE_P
 | 
PTE_W
,

967 0x3a5000 | 
PTE_P
 | 
PTE_W
,

968 0x3a6000 | 
PTE_P
 | 
PTE_W
,

969 0x3a7000 | 
PTE_P
 | 
PTE_W
,

970 0x3a8000 | 
PTE_P
 | 
PTE_W
,

971 0x3a9000 | 
PTE_P
 | 
PTE_W
,

972 0x3Ø000 | 
PTE_P
 | 
PTE_W
,

973 0x3ab000 | 
PTE_P
 | 
PTE_W
,

974 0x3ac000 | 
PTE_P
 | 
PTE_W
,

975 0x3ad000 | 
PTE_P
 | 
PTE_W
,

976 0x3´000 | 
PTE_P
 | 
PTE_W
,

977 0x3af000 | 
PTE_P
 | 
PTE_W
,

978 0x3b0000 | 
PTE_P
 | 
PTE_W
,

979 0x3b1000 | 
PTE_P
 | 
PTE_W
,

980 0x3b2000 | 
PTE_P
 | 
PTE_W
,

981 0x3b3000 | 
PTE_P
 | 
PTE_W
,

982 0x3b4000 | 
PTE_P
 | 
PTE_W
,

983 0x3b5000 | 
PTE_P
 | 
PTE_W
,

984 0x3b6000 | 
PTE_P
 | 
PTE_W
,

985 0x3b7000 | 
PTE_P
 | 
PTE_W
,

986 0x3b8000 | 
PTE_P
 | 
PTE_W
,

987 0x3b9000 | 
PTE_P
 | 
PTE_W
,

988 0x3ba000 | 
PTE_P
 | 
PTE_W
,

989 0x3bb000 | 
PTE_P
 | 
PTE_W
,

990 0x3bc000 | 
PTE_P
 | 
PTE_W
,

991 0x3bd000 | 
PTE_P
 | 
PTE_W
,

992 0x3be000 | 
PTE_P
 | 
PTE_W
,

993 0x3bf000 | 
PTE_P
 | 
PTE_W
,

994 0x3c0000 | 
PTE_P
 | 
PTE_W
,

995 0x3c1000 | 
PTE_P
 | 
PTE_W
,

996 0x3c2000 | 
PTE_P
 | 
PTE_W
,

997 0x3c3000 | 
PTE_P
 | 
PTE_W
,

998 0x3c4000 | 
PTE_P
 | 
PTE_W
,

999 0x3c5000 | 
PTE_P
 | 
PTE_W
,

1000 0x3c6000 | 
PTE_P
 | 
PTE_W
,

1001 0x3c7000 | 
PTE_P
 | 
PTE_W
,

1002 0x3c8000 | 
PTE_P
 | 
PTE_W
,

1003 0x3c9000 | 
PTE_P
 | 
PTE_W
,

1004 0x3ˇ000 | 
PTE_P
 | 
PTE_W
,

1005 0x3cb000 | 
PTE_P
 | 
PTE_W
,

1006 0x3cc000 | 
PTE_P
 | 
PTE_W
,

1007 0x3cd000 | 
PTE_P
 | 
PTE_W
,

1008 0x3˚000 | 
PTE_P
 | 
PTE_W
,

1009 0x3cf000 | 
PTE_P
 | 
PTE_W
,

1010 0x3d0000 | 
PTE_P
 | 
PTE_W
,

1011 0x3d1000 | 
PTE_P
 | 
PTE_W
,

1012 0x3d2000 | 
PTE_P
 | 
PTE_W
,

1013 0x3d3000 | 
PTE_P
 | 
PTE_W
,

1014 0x3d4000 | 
PTE_P
 | 
PTE_W
,

1015 0x3d5000 | 
PTE_P
 | 
PTE_W
,

1016 0x3d6000 | 
PTE_P
 | 
PTE_W
,

1017 0x3d7000 | 
PTE_P
 | 
PTE_W
,

1018 0x3d8000 | 
PTE_P
 | 
PTE_W
,

1019 0x3d9000 | 
PTE_P
 | 
PTE_W
,

1020 0x3da000 | 
PTE_P
 | 
PTE_W
,

1021 0x3db000 | 
PTE_P
 | 
PTE_W
,

1022 0x3dc000 | 
PTE_P
 | 
PTE_W
,

1023 0x3dd000 | 
PTE_P
 | 
PTE_W
,

1024 0x3de000 | 
PTE_P
 | 
PTE_W
,

1025 0x3df000 | 
PTE_P
 | 
PTE_W
,

1026 0x3e0000 | 
PTE_P
 | 
PTE_W
,

1027 0x3e1000 | 
PTE_P
 | 
PTE_W
,

1028 0x3e2000 | 
PTE_P
 | 
PTE_W
,

1029 0x3e3000 | 
PTE_P
 | 
PTE_W
,

1030 0x3e4000 | 
PTE_P
 | 
PTE_W
,

1031 0x3e5000 | 
PTE_P
 | 
PTE_W
,

1032 0x3e6000 | 
PTE_P
 | 
PTE_W
,

1033 0x3e7000 | 
PTE_P
 | 
PTE_W
,

1034 0x3e8000 | 
PTE_P
 | 
PTE_W
,

1035 0x3e9000 | 
PTE_P
 | 
PTE_W
,

1036 0x3ó000 | 
PTE_P
 | 
PTE_W
,

1037 0x3eb000 | 
PTE_P
 | 
PTE_W
,

1038 0x3ec000 | 
PTE_P
 | 
PTE_W
,

1039 0x3ed000 | 
PTE_P
 | 
PTE_W
,

1040 0x3ì000 | 
PTE_P
 | 
PTE_W
,

1041 0x3ef000 | 
PTE_P
 | 
PTE_W
,

1042 0x3f0000 | 
PTE_P
 | 
PTE_W
,

1043 0x3f1000 | 
PTE_P
 | 
PTE_W
,

1044 0x3f2000 | 
PTE_P
 | 
PTE_W
,

1045 0x3f3000 | 
PTE_P
 | 
PTE_W
,

1046 0x3f4000 | 
PTE_P
 | 
PTE_W
,

1047 0x3f5000 | 
PTE_P
 | 
PTE_W
,

1048 0x3f6000 | 
PTE_P
 | 
PTE_W
,

1049 0x3f7000 | 
PTE_P
 | 
PTE_W
,

1050 0x3f8000 | 
PTE_P
 | 
PTE_W
,

1051 0x3f9000 | 
PTE_P
 | 
PTE_W
,

1052 0x3Á000 | 
PTE_P
 | 
PTE_W
,

1053 0x3fb000 | 
PTE_P
 | 
PTE_W
,

1054 0x3fc000 | 
PTE_P
 | 
PTE_W
,

1055 0x3fd000 | 
PTE_P
 | 
PTE_W
,

1056 0x3„000 | 
PTE_P
 | 
PTE_W
,

1057 0x3ff000 | 
PTE_P
 | 
PTE_W
,

1058 
	}
};

	@env.c

3 
	~<öc/x86.h
>

4 
	~<öc/mmu.h
>

5 
	~<öc/îr‹.h
>

6 
	~<öc/°rög.h
>

7 
	~<öc/as£π.h
>

8 
	~<öc/ñf.h
>

10 
	~<kîn/ív.h
>

11 
	~<kîn/pm≠.h
>

12 
	~<kîn/å≠.h
>

13 
	~<kîn/m⁄ô‹.h
>

15 
Env
 *
	gívs
 = 
NULL
;

16 
Env
 *
	gcuªnv
 = 
NULL
;

17 
Env
 *
	gív_‰ì_li°
;

20 
	#ENVGENSHIFT
 12

21 

	)

37 
Segdesc
 
	ggdt
[] =

40 
SEG_NULL
,

43 [
GD_KT
 >> 3] = 
SEG
(
STA_X
 | 
STA_R
, 0x0, 0xffffffff, 0),

46 [
GD_KD
 >> 3] = 
SEG
(
STA_W
, 0x0, 0xffffffff, 0),

49 [
GD_UT
 >> 3] = 
SEG
(
STA_X
 | 
STA_R
, 0x0, 0xffffffff, 3),

52 [
GD_UD
 >> 3] = 
SEG
(
STA_W
, 0x0, 0xffffffff, 3),

55 [
GD_TSS0
 >> 3] = 
SEG_NULL


58 
P£udodesc
 
	ggdt_pd
 = {

59 (
gdt
) - 1, () gdt

73 
	$ívid2ív
(
ívid_t
 
ívid
, 
Env
 **
ív_°‹e
, 
boﬁ
 
check≥rm
)

75 
Env
 *
e
;

78 i‡(
ívid
 == 0) {

79 *
ív_°‹e
 = 
cuªnv
;

88 
e
 = &
ívs
[
	`ENVX
(
ívid
)];

89 i‡(
e
->
ív_°©us
 =
ENV_FREE
 ||É->
ív_id
 !
ívid
) {

90 *
ív_°‹e
 = 0;

91  -
E_BAD_ENV
;

99 i‡(
check≥rm
 && 
e
 !
cuªnv
 &&É->
ív_∑ª¡_id
 !cuªnv->
ív_id
) {

100 *
ív_°‹e
 = 0;

101  -
E_BAD_ENV
;

104 *
ív_°‹e
 = 
e
;

106 
	}
}

115 
	$ív_öô
()

120 
i
 = 0; i < 
NENV
; i++) {

121 
ívs
[
i
].
ív_ids
 = 0;

122 
ívs
[
i
]

123 
ív_‰ì_li°
 = &
ívs
[
i
];

126 
	`ív_öô_≥r˝u
();

127 
	}
}

131 
	$ív_öô_≥r˝u
()

133 
	`lgdt
(&
gdt_pd
);

136 
asm
 vﬁ©ûe("movw %%ax,%%gs" :: "a" (
GD_UD
|3));

137 
asm
 vﬁ©ûe("movw %%ax,%%fs" :: "a" (
GD_UD
|3));

140 
asm
 vﬁ©ûe("movw %%ax,%%es" :: "a" (
GD_KD
));

141 
asm
 vﬁ©ûe("movw %%ax,%%ds" :: "a" (
GD_KD
));

142 
asm
 vﬁ©ûe("movw %%ax,%%ss" :: "a" (
GD_KD
));

144 
asm
 vﬁ©ûe("ljm∞%0,$1f\¿1:\n" :: "i" (
GD_KT
));

147 
	`Œdt
(0);

148 
	}
}

161 
	$ív_£tup_vm
(
Env
 *
e
)

163 
i
;

164 
PageInfo
 *
p
 = 
NULL
;

167 i‡(!(
p
 = 
	`∑ge_Æloc
(
ALLOC_ZERO
)))

168  -
E_NO_MEM
;

190 
e
->
ív_pgdú
[
	`PDX
(
UVPT
)] = 
	`PADDR
”->ív_pgdúË| 
PTE_P
 | 
PTE_U
;

193 
	}
}

204 
	$ív_Æloc
(
Env
 **
√wív_°‹e
, 
ívid_t
 
∑ª¡_id
)

206 
öt32_t
 
gíî©i⁄
;

207 
r
;

208 
Env
 *
e
;

210 i‡(!(
e
 = 
ív_‰ì_li°
))

211  -
E_NO_FREE_ENV
;

214 i‡((
r
 = 
	`ív_£tup_vm
(
e
)) < 0)

215  
r
;

218 
gíî©i⁄
 = (
e
->
ív_id
 + (1 << 
ENVGENSHIFT
)Ë& ~(
NENV
 - 1);

219 i‡(
gíî©i⁄
 <= 0)

220 
gíî©i⁄
 = 1 << 
ENVGENSHIFT
;

221 
e
->
ív_id
 = 
gíî©i⁄
 | (ê- 
ívs
);

224 
e
->
ív_∑ª¡_id
 = 
∑ª¡_id
;

225 
e
->
ív_ty≥
 = 
ENV_TYPE_USER
;

226 
e
->
ív_°©us
 = 
ENV_RUNNABLE
;

227 
e
->
ív_runs
 = 0;

233 
	`mem£t
(&
e
->
ív_tf
, 0, (e->env_tf));

243 
e
->
ív_tf
.
tf_ds
 = 
GD_UD
 | 3;

244 
e
->
ív_tf
.
tf_es
 = 
GD_UD
 | 3;

245 
e
->
ív_tf
.
tf_ss
 = 
GD_UD
 | 3;

246 
e
->
ív_tf
.
tf_e•
 = 
USTACKTOP
;

247 
e
->
ív_tf
.
tf_cs
 = 
GD_UT
 | 3;

251 
ív_‰ì_li°
 = 
e
->
ív_lök
;

252 *
√wív_°‹e
 = 
e
;

254 
	`˝rötf
("[%08x]ÇewÉnv %08x\n", 
cuªnv
 ? cuªnv->
ív_id
 : 0, 
e
->env_id);

256 
	}
}

266 
	$ªgi⁄_Æloc
(
Env
 *
e
, *
va
, 
size_t
 
Àn
)

275 
	}
}

300 
	$lﬂd_icode
(
Env
 *
e
, 
uöt8_t
 *
bö¨y
, 
size_t
 
size
)

336 
	}
}

346 
	$ív_¸óã
(
uöt8_t
 *
bö¨y
, 
size_t
 
size
, 
EnvTy≥
 
ty≥
)

349 
	}
}

355 
	$ív_‰ì
(
Env
 *
e
)

357 
±e_t
 *
±
;

358 
uöt32_t
 
pdío
, 
±ío
;

359 
phyßddr_t
 
∑
;

364 i‡(
e
 =
cuªnv
)

365 
	`l¸3
(
	`PADDR
(
kîn_pgdú
));

368 
	`˝rötf
("[%08x] fªêív %08x\n", 
cuªnv
 ? cuªnv->
ív_id
 : 0, 
e
->env_id);

371 
	`°©ic_as£π
(
UTOP
 % 
PTSIZE
 == 0);

372 
pdío
 = 0;Ödíÿ< 
	`PDX
(
UTOP
);Ödeno++) {

375 i‡(!(
e
->
ív_pgdú
[
pdío
] & 
PTE_P
))

379 
∑
 = 
	`PTE_ADDR
(
e
->
ív_pgdú
[
pdío
]);

380 
±
 = (
±e_t
*Ë
	`KADDR
(
∑
);

383 
±ío
 = 0;Öãnÿ<
	`PTX
(~0);Öteno++) {

384 i‡(
±
[
±ío
] & 
PTE_P
)

385 
	`∑ge_ªmove
(
e
->
ív_pgdú
, 
	`PGADDR
(
pdío
, 
±ío
, 0));

389 
e
->
ív_pgdú
[
pdío
] = 0;

390 
	`∑ge_de¸ef
(
	`∑2∑ge
(
∑
));

394 
∑
 = 
	`PADDR
(
e
->
ív_pgdú
);

395 
e
->
ív_pgdú
 = 0;

396 
	`∑ge_de¸ef
(
	`∑2∑ge
(
∑
));

399 
e
->
ív_°©us
 = 
ENV_FREE
;

400 
e
->
ív_lök
 = 
ív_‰ì_li°
;

401 
ív_‰ì_li°
 = 
e
;

402 
	}
}

408 
	$ív_de°roy
(
Env
 *
e
)

410 
	`ív_‰ì
(
e
);

412 
	`˝rötf
("DestroyedÅhe onlyÉnvironment -Çothing moreÅo do!\n");

414 
	`m⁄ô‹
(
NULL
);

415 
	}
}

425 
	$ív_p›_tf
(
Tøp‰ame
 *
tf
)

427 
__asm
 
	`__vﬁ©ûe
("movl %0,%%esp\n"

433 : : "g" (
tf
) : "memory");

434 
	`∑nic
("iret failed");

435 
	}
}

444 
	$ív_run
(
Env
 *
e
)

465 
	`∑nic
("env_runÇot yet implemented");

466 
	}
}

	@env.h

3 #i‚de‡
JOS_KERN_ENV_H


4 
	#JOS_KERN_ENV_H


	)

6 
	~<öc/ív.h
>

8 
Env
 *
ívs
;

9 
Env
 *
cuªnv
;

10 
Segdesc
 
gdt
[];

12 
ív_öô
();

13 
ív_öô_≥r˝u
();

14 
ív_Æloc
(
Env
 **
e
, 
ívid_t
 
∑ª¡_id
);

15 
ív_‰ì
(
Env
 *
e
);

16 
ív_¸óã
(
uöt8_t
 *
bö¨y
, 
size_t
 
size
, 
EnvTy≥
 
ty≥
);

17 
ív_de°roy
(
Env
 *
e
);

19 
ívid2ív
(
ívid_t
 
ívid
, 
Env
 **
ív_°‹e
, 
boﬁ
 
check≥rm
);

21 
	$ív_run
(
Env
 *
e
Ë
	`__©åibuã__
((
n‹ëu∫
));

22 
	$ív_p›_tf
(
Tøp‰ame
 *
tf
Ë
	`__©åibuã__
((
n‹ëu∫
));

26 
	#ENV_PASTE3
(
x
, 
y
, 
z
Ëx ## y ## 
	)
z

28 
	#ENV_CREATE
(
x
, 
ty≥
) \

30 
uöt8_t
 
	`ENV_PASTE3
(
_bö¨y_obj_
, 
x
, 
_°¨t
)[], \

31 
	`ENV_PASTE3
(
_bö¨y_obj_
, 
x
, 
_size
)[]; \

32 
	`ív_¸óã
(
	`ENV_PASTE3
(
_bö¨y_obj_
, 
x
, 
_°¨t
), \

33 ()
	`ENV_PASTE3
(
_bö¨y_obj_
, 
x
, 
_size
), \

34 
ty≥
); \

35 
	}
} 0)

	)

	@init.c

3 
	~<öc/°dio.h
>

4 
	~<öc/°rög.h
>

5 
	~<öc/as£π.h
>

7 
	~<kîn/m⁄ô‹.h
>

8 
	~<kîn/c⁄sﬁe.h
>

9 
	~<kîn/pm≠.h
>

10 
	~<kîn/k˛ock.h
>

11 
	~<kîn/ív.h
>

12 
	~<kîn/å≠.h
>

16 
	$i386_öô
()

18 
ed©a
[], 
íd
[];

23 
	`mem£t
(
ed©a
, 0, 
íd
 -Édata);

27 
	`c⁄s_öô
();

28 
	`˝rötf
("6828 decimal is %o octal!\n", 6828);

31 
	`mem_öô
();

35 
	`ív_öô
();

36 
	`å≠_öô
();

38 #i‡
	`deföed
(
TEST
)

40 
	`ENV_CREATE
(
TEST
, 
ENV_TYPE_USER
);

43 
	`ENV_CREATE
(
u£r_hñlo
, 
ENV_TYPE_USER
);

47 
	`ív_run
(&
ívs
[0]);

48 
	}
}

55 c⁄° *
	g∑nic°r
;

62 
	$_∑nic
(c⁄° *
fûe
, 
löe
, c⁄° *
fmt
,...)

64 
va_li°
 
≠
;

66 i‡(
∑nic°r
)

67 
dód
;

68 
∑nic°r
 = 
fmt
;

71 
__asm
 
	`__vﬁ©ûe
("cli; cld");

73 
	`va_°¨t
(
≠
, 
fmt
);

74 
	`˝rötf
("kî√»∑ni¯© %s:%d: ", 
fûe
, 
löe
);

75 
	`v˝rötf
(
fmt
, 
≠
);

76 
	`˝rötf
("\n");

77 
	`va_íd
(
≠
);

79 
dód
:

82 
	`m⁄ô‹
(
NULL
);

83 
	}
}

87 
	$_w¨n
(c⁄° *
fûe
, 
löe
, c⁄° *
fmt
,...)

89 
va_li°
 
≠
;

91 
	`va_°¨t
(
≠
, 
fmt
);

92 
	`˝rötf
("kî√»w¨nögáà%s:%d: ", 
fûe
, 
löe
);

93 
	`v˝rötf
(
fmt
, 
≠
);

94 
	`˝rötf
("\n");

95 
	`va_íd
(
≠
);

96 
	}
}

	@kclock.c

5 
	~<öc/x86.h
>

7 
	~<kîn/k˛ock.h
>

11 
	$mc146818_ªad
(
ªg
)

13 
	`outb
(
IO_RTC
, 
ªg
);

14  
	`öb
(
IO_RTC
+1);

15 
	}
}

18 
	$mc146818_wrôe
(
ªg
, 
d©um
)

20 
	`outb
(
IO_RTC
, 
ªg
);

21 
	`outb
(
IO_RTC
+1, 
d©um
);

22 
	}
}

	@kclock.h

3 #i‚de‡
JOS_KERN_KCLOCK_H


4 
	#JOS_KERN_KCLOCK_H


	)

5 #i‚de‡
JOS_KERNEL


9 
	#IO_RTC
 0x070

	)

11 
	#MC_NVRAM_START
 0xê

	)

12 
	#MC_NVRAM_SIZE
 50

	)

15 
	#NVRAM_BASELO
 (
MC_NVRAM_START
 + 7Ë

	)

16 
	#NVRAM_BASEHI
 (
MC_NVRAM_START
 + 8Ë

	)

19 
	#NVRAM_EXTLO
 (
MC_NVRAM_START
 + 9Ë

	)

20 
	#NVRAM_EXTHI
 (
MC_NVRAM_START
 + 10Ë

	)

23 
	#NVRAM_PEXTLO
 (
MC_NVRAM_START
 + 34Ë

	)

24 
	#NVRAM_PEXTHI
 (
MC_NVRAM_START
 + 35Ë

	)

27 
	#NVRAM_CENTURY
 (
MC_NVRAM_START
 + 36Ë

	)

29 
mc146818_ªad
(
ªg
);

30 
mc146818_wrôe
(
ªg
, 
d©um
);

	@kdebug.c

1 
	~<öc/°ab.h
>

2 
	~<öc/°rög.h
>

3 
	~<öc/memœyout.h
>

4 
	~<öc/as£π.h
>

6 
	~<kîn/kdebug.h
>

7 
	~<kîn/pm≠.h
>

8 
	~<kîn/ív.h
>

10 c⁄° 
Sèb
 
__STAB_BEGIN__
[];

11 c⁄° 
Sèb
 
__STAB_END__
[];

12 c⁄° 
__STABSTR_BEGIN__
[];

13 c⁄° 
__STABSTR_END__
[];

15 
	sU£rSèbD©a
 {

16 c⁄° 
Sèb
 *
	m°abs
;

17 c⁄° 
Sèb
 *
	m°ab_íd
;

18 c⁄° *
	m°ab°r
;

19 c⁄° *
	m°ab°r_íd
;

60 
	$°ab_bö£¨ch
(c⁄° 
Sèb
 *
°abs
, *
ªgi⁄_À·
, *
ªgi⁄_right
,

61 
ty≥
, 
uöçå_t
 
addr
)

63 
l
 = *
ªgi⁄_À·
, 
r
 = *
ªgi⁄_right
, 
™y_m©ches
 = 0;

65 
l
 <
r
) {

66 
åue_m
 = (
l
 + 
r
Ë/ 2, 
m
 =Årue_m;

69 
m
 >
l
 && 
°abs
[m].
n_ty≥
 !
ty≥
)

70 
m
--;

71 i‡(
m
 < 
l
) {

72 
l
 = 
åue_m
 + 1;

77 
™y_m©ches
 = 1;

78 i‡(
°abs
[
m
].
n_vÆue
 < 
addr
) {

79 *
ªgi⁄_À·
 = 
m
;

80 
l
 = 
åue_m
 + 1;

81 } i‡(
°abs
[
m
].
n_vÆue
 > 
addr
) {

82 *
ªgi⁄_right
 = 
m
 - 1;

83 
r
 = 
m
 - 1;

87 *
ªgi⁄_À·
 = 
m
;

88 
l
 = 
m
;

89 
addr
++;

93 i‡(!
™y_m©ches
)

94 *
ªgi⁄_right
 = *
ªgi⁄_À·
 - 1;

97 
l
 = *
ªgi⁄_right
;

98 
l
 > *
ªgi⁄_À·
 && 
°abs
[l].
n_ty≥
 !
ty≥
;

99 
l
--)

101 *
ªgi⁄_À·
 = 
l
;

103 
	}
}

114 
	$debugöfo_eù
(
uöçå_t
 
addr
, 
Eùdebugöfo
 *
öfo
)

116 c⁄° 
Sèb
 *
°abs
, *
°ab_íd
;

117 c⁄° *
°ab°r
, *
°ab°r_íd
;

118 
lfûe
, 
rfûe
, 
lfun
, 
rfun
, 
Œöe
, 
æöe
;

121 
öfo
->
eù_fûe
 = "<unknown>";

122 
öfo
->
eù_löe
 = 0;

123 
öfo
->
eù_‚_«me
 = "<unknown>";

124 
öfo
->
eù_‚_«mñí
 = 9;

125 
öfo
->
eù_‚_addr
 = 
addr
;

126 
öfo
->
eù_‚_«rg
 = 0;

129 i‡(
addr
 >
ULIM
) {

130 
°abs
 = 
__STAB_BEGIN__
;

131 
°ab_íd
 = 
__STAB_END__
;

132 
°ab°r
 = 
__STABSTR_BEGIN__
;

133 
°ab°r_íd
 = 
__STABSTR_END__
;

140 c⁄° 
U£rSèbD©a
 *
usd
 = (c⁄° U£rSèbD©®*Ë
USTABDATA
;

146 
°abs
 = 
usd
->stabs;

147 
°ab_íd
 = 
usd
->stab_end;

148 
°ab°r
 = 
usd
->stabstr;

149 
°ab°r_íd
 = 
usd
->stabstr_end;

156 i‡(
°ab°r_íd
 <
°ab°r
 || stabstr_end[-1] != 0)

165 
lfûe
 = 0;

166 
rfûe
 = (
°ab_íd
 - 
°abs
) - 1;

167 
	`°ab_bö£¨ch
(
°abs
, &
lfûe
, &
rfûe
, 
N_SO
, 
addr
);

168 i‡(
lfûe
 == 0)

173 
lfun
 = 
lfûe
;

174 
rfun
 = 
rfûe
;

175 
	`°ab_bö£¨ch
(
°abs
, &
lfun
, &
rfun
, 
N_FUN
, 
addr
);

177 i‡(
lfun
 <
rfun
) {

180 i‡(
°abs
[
lfun
].
n_°rx
 < 
°ab°r_íd
 - 
°ab°r
)

181 
öfo
->
eù_‚_«me
 = 
°ab°r
 + 
°abs
[
lfun
].
n_°rx
;

182 
öfo
->
eù_‚_addr
 = 
°abs
[
lfun
].
n_vÆue
;

183 
addr
 -
öfo
->
eù_‚_addr
;

185 
Œöe
 = 
lfun
;

186 
æöe
 = 
rfun
;

190 
öfo
->
eù_‚_addr
 = 
addr
;

191 
Œöe
 = 
lfûe
;

192 
æöe
 = 
rfûe
;

195 
öfo
->
eù_‚_«mñí
 = 
	`°rföd
(öfo->
eù_‚_«me
, ':') - info->eip_fn_name;

207 
	`°ab_bö£¨ch
(
°abs
, &
Œöe
, &
æöe
, 
N_SLINE
, 
addr
);

208 i‡(
Œöe
 <
æöe
) {

209 
öfo
->
eù_löe
 = 
°abs
[
Œöe
].
n_desc
;

211 
öfo
->
eù_löe
 = -1;

219 
Œöe
 >
lfûe


220 && 
°abs
[
Œöe
].
n_ty≥
 !
N_SOL


221 && (
°abs
[
Œöe
].
n_ty≥
 !
N_SO
 || !°abs[Œöe].
n_vÆue
))

222 
Œöe
--;

223 i‡(
Œöe
 >
lfûe
 && 
°abs
[Œöe].
n_°rx
 < 
°ab°r_íd
 - 
°ab°r
)

224 
öfo
->
eù_fûe
 = 
°ab°r
 + 
°abs
[
Œöe
].
n_°rx
;

229 i‡(
lfun
 < 
rfun
)

230 
Œöe
 = 
lfun
 + 1;

231 
Œöe
 < 
rfun
 && 
°abs
[Œöe].
n_ty≥
 =
N_PSYM
;

232 
Œöe
++)

233 
öfo
->
eù_‚_«rg
++;

236 
	}
}

	@kdebug.h

1 #i‚de‡
JOS_KERN_KDEBUG_H


2 
	#JOS_KERN_KDEBUG_H


	)

4 
	~<öc/ty≥s.h
>

7 
	sEùdebugöfo
 {

8 c⁄° *
	meù_fûe
;

9 
	meù_löe
;

11 c⁄° *
	meù_‚_«me
;

13 
	meù_‚_«mñí
;

14 
uöçå_t
 
	meù_‚_addr
;

15 
	meù_‚_«rg
;

18 
debugöfo_eù
(
uöçå_t
 
eù
, 
Eùdebugöfo
 *
öfo
);

	@kernel.h

	@monitor.c

4 
	~<öc/°dio.h
>

5 
	~<öc/°rög.h
>

6 
	~<öc/memœyout.h
>

7 
	~<öc/as£π.h
>

8 
	~<öc/x86.h
>

10 
	~<kîn/c⁄sﬁe.h
>

11 
	~<kîn/m⁄ô‹.h
>

12 
	~<kîn/kdebug.h
>

13 
	~<kîn/å≠.h
>

14 
	~<kîn/pm≠.h
>

16 
	#CMDBUF_SIZE
 80

17 
	#COLOR_WHT
 7;

	)

18 
	#COLOR_BLK
 0;

	)

19 
	#COLOR_BLU
 1;

	)

20 
	#COLOR_GRN
 2;

	)

21 
	#COLOR_RED
 4;

	)

22 
	#COLOR_GRY
 8;

	)

23 
	#COLOR_YLW
 15;

	)

24 
	#COLOR_ORG
 12;

	)

25 
	#COLOR_PUR
 6;

	)

26 
	#COLOR_CYN
 11;

	)

28 
	sComm™d
 {

29 c⁄° *
	m«me
;

30 c⁄° *
	mdesc
;

32 (*
	mfunc
)(
	m¨gc
, ** 
	m¨gv
, 
Tøp‰ame
* 
	mtf
);

35 
Comm™d
 
	gcomm™ds
[] = {

36 { "hñp", "Di•œyÅhi†li° o‡comm™ds", 
m⁄_hñp
 },

37 { "kînöfo", "Di•œy inf‹m©i⁄ábouàthêkî√l", 
m⁄_kînöfo
 },

38 { "£tcﬁ‹", "£àthêcﬁ‹ f‹Åext", 
m⁄_£tcﬁ‹
 },

39 { "backåa˚", "Di•œy inf‹m©i⁄ábouàeb∞&Éù", 
m⁄_backåa˚
 },

40 { "showm≠pögs", "DisPœyÅhêphysiˇ»∑gêm≠pög†™d c‹ª•⁄dögÖîmissi⁄ bô†th©áµlyÅÿthê∑ges\¿ showm≠pög†®b, di•œyÅhêöf‹m©i⁄ fromáÅÿb", 
m⁄_showm≠pög
 },

41 { "£ç", "£ç Pîmissi⁄, CÀ¨Åhêaddªss'†≥rmissi⁄ by deÁu…\¿ së∞v®PTE_U PTE_W PTE_W", 
m⁄_ch™gePîmissi⁄
 },

42 { "dump", "dum∞thêvútuÆ o∏physiˇ»addªs†o‡thêmem‹y", 
m⁄_dump
 },

43 { "PT", "showÅhê∑gêèbÀ o‡givíáddªss", 
m⁄_showPT
 }

45 
	#NCOMMANDS
 ((
comm™ds
)/(comm™ds[0]))

	)

50 
	$m⁄_hñp
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
)

52 
i
;

54 
i
 = 0; i < 
NCOMMANDS
; i++)

55 
	`˝rötf
("%†- %s\n", 
comm™ds
[
i
].
«me
, comm™ds[i].
desc
);

57 
	}
}

59 
	$m⁄_£tcﬁ‹
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
) {

61 
uöt16_t
 
ch_cﬁ‹1
, 
ch_cﬁ‹
;

62 if(
	`°rcmp
(
¨gv
[2],"blk")==0)

63 
ch_cﬁ‹1
=
COLOR_BLK


64 if(
	`°rcmp
(
¨gv
[2],"wht")==0)

65 
ch_cﬁ‹1
=
COLOR_WHT


66 if(
	`°rcmp
(
¨gv
[2],"blu")==0)

67 
ch_cﬁ‹1
=
COLOR_BLU


68 if(
	`°rcmp
(
¨gv
[2],"grn")==0)

69 
ch_cﬁ‹1
=
COLOR_GRN


70 if(
	`°rcmp
(
¨gv
[2],"red")==0)

71 
ch_cﬁ‹1
=
COLOR_RED


72 if(
	`°rcmp
(
¨gv
[2],"gry")==0)

73 
ch_cﬁ‹1
=
COLOR_GRY


74 if(
	`°rcmp
(
¨gv
[2],"ylw")==0)

75 
ch_cﬁ‹1
=
COLOR_YLW


76 if(
	`°rcmp
(
¨gv
[2],"org")==0)

77 
ch_cﬁ‹1
=
COLOR_ORG


78 if(
	`°rcmp
(
¨gv
[2],"pur")==0)

79 
ch_cﬁ‹1
=
COLOR_PUR


80 if(
	`°rcmp
(
¨gv
[2],"cyn")==0)

81 
ch_cﬁ‹1
=
COLOR_CYN


82 
ch_cﬁ‹1
=
COLOR_WHT
;

83 if(
	`°rcmp
(
¨gv
[1],"blk")==0)

84 
ch_cﬁ‹
=
COLOR_BLK


85 if(
	`°rcmp
(
¨gv
[1],"wht")==0)

86 
ch_cﬁ‹
=
COLOR_WHT


87 if(
	`°rcmp
(
¨gv
[1],"blu")==0)

88 
ch_cﬁ‹
=
COLOR_BLU


89 if(
	`°rcmp
(
¨gv
[1],"grn")==0)

90 
ch_cﬁ‹
=
COLOR_GRN


91 if(
	`°rcmp
(
¨gv
[1],"red")==0)

92 
ch_cﬁ‹
=
COLOR_RED


93 if(
	`°rcmp
(
¨gv
[1],"gry")==0)

94 
ch_cﬁ‹
=
COLOR_GRY


95 if(
	`°rcmp
(
¨gv
[1],"ylw")==0)

96 
ch_cﬁ‹
=
COLOR_YLW


97 if(
	`°rcmp
(
¨gv
[1],"org")==0)

98 
ch_cﬁ‹
=
COLOR_ORG


99 if(
	`°rcmp
(
¨gv
[1],"pur")==0)

100 
ch_cﬁ‹
=
COLOR_PUR


101 if(
	`°rcmp
(
¨gv
[1],"cyn")==0)

102 
ch_cﬁ‹
=
COLOR_CYN


103 
ch_cﬁ‹
=
COLOR_WHT
;

104 
	`£t_©åibuã_cﬁ‹
((
uöt64_t
Ë
ch_cﬁ‹
, (uöt64_tË
ch_cﬁ‹1
);

105 
	`˝rötf
("c⁄sﬁêback-cﬁ‹ : %d \¿ f‹e-cﬁ‹ : %d\n", 
ch_cﬁ‹
, 
ch_cﬁ‹1
);

107 
	}
}

109 
	$¥ötPîmissi⁄
(
±e_t
 
now
) {

110 
	`˝rötf
("PTE_U : %d ", ((
now
 & 
PTE_U
) != 0));

111 
	`˝rötf
("PTE_W : %d ", ((
now
 & 
PTE_W
) != 0));

112 
	`˝rötf
("PTE_P : %d ", ((
now
 & 
PTE_P
) != 0));

113 
	}
}

115 
uöt32_t
 
	$xtoi
(* 
‹igö
, 
boﬁ
* 
check
) {

116 
uöt32_t
 
i
 = 0, 
ãmp
 = 0, 
Àn
 = 
	`°æí
(
‹igö
);

117 *
check
 = 
åue
;

118 i‡((
‹igö
[0] != '0') || (origin[1] != 'x' && origin[1] != 'X'))

120 *
check
 = 
Ál£
;

123 
i
 = 2; i < 
Àn
; i++) {

124 
ãmp
 *= 16;

125 i‡(
‹igö
[
i
] >= '0' && origin[i] <= '9')

126 
ãmp
 +
‹igö
[
i
] - '0';

127 i‡(
‹igö
[
i
] >= 'a' && origin[i] <= 'f')

128 
ãmp
 +
‹igö
[
i
] - 'a' + 10;

129 i‡(
‹igö
[
i
] >= 'A' && origin[i] <= 'F')

130 
ãmp
 +
‹igö
[
i
] - 'A' + 10;

132 *
check
 = 
Ál£
;

136  
ãmp
;

137 
	}
}

139 
boﬁ
 
	$pxtoi
(
uöt32_t
 *
va
, *
‹igö
) {

140 
boﬁ
 
check
 = 
åue
;

141 *
va
 = 
	`xtoi
(
‹igö
, &
check
);

142 i‡(!
check
) {

143 
	`˝rötf
("AddressÅypingÉrror\n");

144  
Ál£
;

146  
åue
;

147 
	}
}

149 
	$m⁄_ch™gePîmissi⁄
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
)

151 i‡(
¨gc
 < 2) {

152 
	`˝rötf
("invalidÇumber ofÖarameters\n");

155 
uöçå_t
 
va
;

156 i‡(!
	`pxtoi
(&
va
,
¨gv
[1]))  0;

158 
±e_t
* 
m≠≥r
 = 
	`pgdú_wÆk
(
kîn_pgdú
, (*Ë
va
, 1);

159 i‡(!
m≠≥r
)

160 
	`∑nic
("error, out of memory");

161 
phyßddr_t
 
∑
 = 
	`PTE_ADDR
(*
m≠≥r
);

162 
≥rm
 = 0;

164 i‡(
¨gc
 != 2) {

165 i‡(
¨gc
 != 5) {

166 
	`˝rötf
("invalidÇumber ofÖarameters\n");

169 i‡(
¨gv
[2][0] ='1'Ë
≥rm
 |
PTE_U
;

170 i‡(
¨gv
[3][0] ='1'Ë
≥rm
 |
PTE_W
;

171 i‡(
¨gv
[4][0] ='1'Ë
≥rm
 |
PTE_P
;

174 
	`˝rötf
("bef‹êch™gê"); 
	`¥ötPîmissi⁄
(*
m≠≥r
); cprintf("\n");

176 *
m≠≥r
 = 
	`PTE_ADDR
(*m≠≥rË| 
≥rm
;

177 
	`˝rötf
("a·î ch™gê"); 
	`¥ötPîmissi⁄
(*
m≠≥r
); cprintf("\n");

179 
	}
}

182 
	$m⁄_showPT
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
) {

183 
uöçå_t
 
va
;

184 i‡(!
	`pxtoi
(&
va
, 
¨gv
[1]))  0;

186 
±e_t
 *
m≠≥r
 = 
	`pgdú_wÆk
(
kîn_pgdú
, (*Ë((
va
 >> 
PDXSHIFT
) << PDXSHIFT), 1);

187 
	`˝rötf
("PagêTabÀ E¡ry Addªs†: 0x%08x\n", 
m≠≥r
);

189 
	}
}

190 
	#POINT_SIZE
 4

	)

191 
	$m⁄_dump
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
) {

192 
uöt32_t
 
begö
, 
íd
;

193 i‡(
¨gc
 < 3) {

194 
	`˝rötf
("invalid command\n");

197 i‡(!
	`pxtoi
(&
begö
, 
¨gv
[2]))  0;

198 i‡(!
	`pxtoi
(&
íd
, 
¨gv
[3]))  0;

199 i‡(
¨gv
[1][0] == 'p') {

200 i‡(
	`PGNUM
(
íd
Ë>
≈ages
 || PGNUM(end) >=Çpages){

201 
	`˝rötf
("out of memory\n");

204 ;
begö
 <
íd
; begö +
POINT_SIZE
)

205 
	`˝rötf
("∑ 0x%08x : 0x%08x\n", 
begö
, *((
uöt32_t
*)
	`KADDR
(begin)));

206 } i‡(
¨gv
[1][0] == 'v') {

207 ;
begö
 <
íd
; begö+=
POINT_SIZE
) {

208 
	`˝rötf
("V®0x%08x : 0x%08x\n", 
begö
, *((
uöt32_t
*)begin));

210 } 
	`˝rötf
("invalid command\n");

213 
	}
}

214 
	$m⁄_showm≠pög
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
)

216 
uöçå_t
 
begö
, 
íd
;

217 i‡(!
	`pxtoi
(&
begö
, 
¨gv
[1]))  0;

219 i‡(!
	`pxtoi
(&
íd
, 
¨gv
[2]))  0;

220 
begö
 = 
	`ROUNDUP
(begö, 
PGSIZE
);

221 
íd
 = 
	`ROUNDUP
”nd, 
PGSIZE
);

222 ;
begö
 <
íd
; begö +
PGSIZE
) {

223 
±e_t
 *
m≠≥r
 = 
	`pgdú_wÆk
(
kîn_pgdú
, (*Ë
begö
, 1);

224 
	`˝rötf
("VA 0x%08x : ", 
begö
);

225 i‡(
m≠≥r
 !
NULL
) {

226 i‡(*
m≠≥r
 & 
PTE_P
) {

227 
	`˝rötf
("m≠pög 0x%08x ", 
	`PTE_ADDR
(*
m≠≥r
));

228 
	`¥ötPîmissi⁄
((
±e_t
)*
m≠≥r
);

229 
	`˝rötf
("\n");

231 
	`˝rötf
("pageÇot mapping\n");

234 
	`∑nic
("error, out of memory");

238 
	}
}

241 
	$m⁄_kînöfo
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
)

243 
_°¨t
[], 
íåy
[], 
ëext
[], 
ed©a
[], 
íd
[];

245 
	`˝rötf
("Special kernel symbols:\n");

246 
	`˝rötf
(" _°¨à %08x (phys)\n", 
_°¨t
);

247 
	`˝rötf
("É¡ry %08x (vútË %08x (phys)\n", 
íåy
,É¡ry - 
KERNBASE
);

248 
	`˝rötf
("Éãxà %08x (vútË %08x (phys)\n", 
ëext
,Éãxà- 
KERNBASE
);

249 
	`˝rötf
("Éd©® %08x (vútË %08x (phys)\n", 
ed©a
,Éd©®- 
KERNBASE
);

250 
	`˝rötf
("Énd %08x (vútË %08x (phys)\n", 
íd
,Énd - 
KERNBASE
);

251 
	`˝rötf
("KernelÉxecutable memory footprint: %dKB\n",

252 
	`ROUNDUP
(
íd
 - 
íåy
, 1024) / 1024);

254 
	}
}

257 
	$m⁄_backåa˚
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
)

261 
uöt32_t
 *
eù
, *
ebp
;

262 
ebp
 = (
uöt32_t
*Ë
	`ªad_ebp
();

263 
eù
 = (
uöt32_t
*Ë
ebp
[1];

264 
	`˝rötf
("Stackbacktrace:\n");

265 
ebp
!=0) {

266 
	`˝rötf
("eb∞%08xÉù %08xárg†%08x %08x %08x %08x %08x\n",
ebp
, 
eù
,Ébp[2] ,ebp[3],Ébp[4],Ébp[5] ,ebp[6]);

267 
Eùdebugöfo
 
ãmp_debugöfo
;

268 
	`debugöfo_eù
((
uöçå_t
Ë
eù
, &
ãmp_debugöfo
);

269 
	`˝rötf
(" %s:%d: ", 
ãmp_debugöfo
.
eù_fûe
,Åemp_debugöfo.
eù_löe
);

270 
uöt32_t
 
i
 = 0;

271 
i
 < 
ãmp_debugöfo
.
eù_‚_«mñí
){

272 
	`˝rötf
("%c", 
ãmp_debugöfo
.
eù_‚_«me
[
i
]);

273 
i
++;

275 
p
 = ()
eù
;

276 
q
 = ()
ãmp_debugöfo
.
eù_‚_addr
;

277 
	`˝rötf
("+%x\n", 
p
 - 
q
);

278 
ebp
=(
uöt32_t
*)ebp[0];

279 
eù
=(
uöt32_t
*)
ebp
[1];

284 
	}
}

290 
	#WHITESPACE
 "\t\r\¿"

	)

291 
	#MAXARGS
 16

	)

294 
	$runcmd
(*
buf
, 
Tøp‰ame
 *
tf
)

296 
¨gc
;

297 *
¨gv
[
MAXARGS
];

298 
i
;

301 
¨gc
 = 0;

302 
¨gv
[
¨gc
] = 0;

305 *
buf
 && 
	`°rchr
(
WHITESPACE
, *buf))

306 *
buf
++ = 0;

307 i‡(*
buf
 == 0)

311 i‡(
¨gc
 =
MAXARGS
-1) {

312 
	`˝rötf
("Toÿm™yárgumít†(max %d)\n", 
MAXARGS
);

315 
¨gv
[
¨gc
++] = 
buf
;

316 *
buf
 && !
	`°rchr
(
WHITESPACE
, *buf))

317 
buf
++;

319 
¨gv
[
¨gc
] = 0;

322 i‡(
¨gc
 == 0)

324 
i
 = 0; i < 
NCOMMANDS
; i++) {

325 i‡(
	`°rcmp
(
¨gv
[0], 
comm™ds
[
i
].
«me
) == 0)

326  
comm™ds
[
i
].
	`func
(
¨gc
, 
¨gv
, 
tf
);

328 
	`˝rötf
("Unknow¿comm™d '%s'\n", 
¨gv
[0]);

330 
	}
}

333 
	$m⁄ô‹
(
Tøp‰ame
 *
tf
)

335 *
buf
;

337 
	`˝rötf
("WelcomeÅoÅhe JOS kernel monitor!\n");

338 
	`˝rötf
("Type 'help' foráÜist of commands.\n");

340 i‡(
tf
 !
NULL
)

341 
	`¥öt_å≠‰ame
(
tf
);

344 
buf
 = 
	`ªadlöe
("K> ");

345 i‡(
buf
 !
NULL
)

346 i‡(
	`runcmd
(
buf
, 
tf
) < 0)

349 
	}
}

	@monitor.h

1 #i‚de‡
JOS_KERN_MONITOR_H


2 
	#JOS_KERN_MONITOR_H


	)

3 #i‚de‡
JOS_KERNEL


7 
	gTøp‰ame
;

12 
m⁄ô‹
(
Tøp‰ame
 *
tf
);

15 
m⁄_hñp
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
);

16 
m⁄_kînöfo
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
);

17 
m⁄_backåa˚
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
);

18 
m⁄_£tcﬁ‹
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
);

19 
m⁄_backåa˚
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
);

20 
m⁄_showm≠pög
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
);

21 
m⁄_ch™gePîmissi⁄
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
);

22 
m⁄_showPT
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
);

23 
m⁄_dump
(
¨gc
, **
¨gv
, 
Tøp‰ame
 *
tf
);

	@pmap.c

3 
	~<öc/x86.h
>

4 
	~<öc/mmu.h
>

5 
	~<öc/îr‹.h
>

6 
	~<öc/°rög.h
>

7 
	~<öc/as£π.h
>

9 
	~<kîn/pm≠.h
>

10 
	~<kîn/k˛ock.h
>

11 
	~<kîn/ív.h
>

14 
size_t
 
	g≈ages
;

15 
size_t
 
	g≈ages_ba£mem
;

18 
pde_t
 *
	gkîn_pgdú
;

19 
PageInfo
 *
	g∑ges
;

20 
PageInfo
 *
	g∑ge_‰ì_li°
;

28 
	$nvøm_ªad
(
r
)

30  
	`mc146818_ªad
(
r
) | (mc146818_read(r + 1) << 8);

31 
	}
}

34 
	$i386_dëe˘_mem‹y
()

36 
size_t
 
≈ages_extmem
;

40 
≈ages_ba£mem
 = (
	`nvøm_ªad
(
NVRAM_BASELO
Ë* 1024Ë/ 
PGSIZE
;

41 
≈ages_extmem
 = (
	`nvøm_ªad
(
NVRAM_EXTLO
Ë* 1024Ë/ 
PGSIZE
;

45 i‡(
≈ages_extmem
)

46 
≈ages
 = (
EXTPHYSMEM
 / 
PGSIZE
Ë+ 
≈ages_extmem
;

48 
≈ages
 = 
≈ages_ba£mem
;

50 
	`˝rötf
("Physical memory: %uKávailable, base = %uK,Éxtended = %uK\n",

51 
≈ages
 * 
PGSIZE
 / 1024,

52 
≈ages_ba£mem
 * 
PGSIZE
 / 1024,

53 
≈ages_extmem
 * 
PGSIZE
 / 1024);

54 
	}
}

61 
boŸ_m≠_ªgi⁄
(
pde_t
 *
pgdú
, 
uöçå_t
 
va
, 
size_t
 
size
, 
phyßddr_t
 
∑
, 
≥rm
);

62 
check_∑ge_‰ì_li°
(
boﬁ
 
⁄ly_low_mem‹y
);

63 
check_∑ge_Æloc
();

64 
check_kîn_pgdú
();

65 
phyßddr_t
 
check_va2∑
(
pde_t
 *
pgdú
, 
uöçå_t
 
va
);

66 
check_∑ge
();

67 
check_∑ge_ö°ÆÀd_pgdú
();

82 
	$boŸ_Æloc
(
uöt32_t
 
n
)

84 *
√xt‰ì
;

85 *
ªsu…
;

92 i‡(!
√xt‰ì
) {

93 
íd
[];

94 
√xt‰ì
 = 
	`ROUNDUP
((*Ë
íd
, 
PGSIZE
);

103 i‡(
n
 > 0) {

104 *
ãmp
 = 
√xt‰ì
;

105 
√xt‰ì
 +
n
;

106 
√xt‰ì
 = 
	`ROUNDUP
“ext‰ì, 
PGSIZE
);

107  
ãmp
;

108 } i‡(
n
 == 0) {

109  (*)
√xt‰ì
;

111  
NULL
;

112 
	}
}

124 
	$mem_öô
()

126 
uöt32_t
 
¸0
;

127 
size_t
 
n
;

130 
	`i386_dëe˘_mem‹y
();

137 
kîn_pgdú
 = (
pde_t
 *Ë
	`boŸ_Æloc
(
PGSIZE
);

138 
	`mem£t
(
kîn_pgdú
, 0, 
PGSIZE
);

146 
kîn_pgdú
[
	`PDX
(
UVPT
)] = 
	`PADDR
(kîn_pgdúË| 
PTE_U
 | 
PTE_P
;

154 
∑ges
 = (
PageInfo
*Ë
	`boŸ_Æloc
(
≈ages
 * (PageInfo));

159 
ívs
 = (
Env
*Ë
	`boŸ_Æloc
(
NENV
 * (Env));

167 
	`∑ge_öô
();

170 
	`check_∑ge_‰ì_li°
(1);

171 
	`check_∑ge_Æloc
();

172 
	`check_∑ge
();

184 
	`boŸ_m≠_ªgi⁄
(
kîn_pgdú
, 
UPAGES
, 
	`ROUNDUP
(
≈ages
 * (
PageInfo
), 
PGSIZE
), 
	`PADDR
(
∑ges
), 
PTE_U
 | 
PTE_P
);

193 
	`boŸ_m≠_ªgi⁄
(
kîn_pgdú
, 
UENVS
, 
	`ROUNDUP
(
NENV
 * (
Env
), 
PGSIZE
), 
	`PADDR
(
ívs
), 
PTE_U
 | 
PTE_P
);

206 
	`boŸ_m≠_ªgi⁄
(
kîn_pgdú
, 
KSTACKTOP
 - 
KSTKSIZE
, KSTKSIZE, 
	`PADDR
(
boŸ°ack
), 
PTE_W
);

215 
	`boŸ_m≠_ªgi⁄
(
kîn_pgdú
, 
KERNBASE
, - KERNBASE, 0, 
PTE_W
);

218 
	`check_kîn_pgdú
();

227 
	`l¸3
(
	`PADDR
(
kîn_pgdú
));

229 
	`check_∑ge_‰ì_li°
(0);

233 
¸0
 = 
	`r¸0
();

234 
¸0
 |
CR0_PE
|
CR0_PG
|
CR0_AM
|
CR0_WP
|
CR0_NE
|
CR0_MP
;

235 
¸0
 &~(
CR0_TS
|
CR0_EM
);

236 
	`l¸0
(
¸0
);

239 
	`check_∑ge_ö°ÆÀd_pgdú
();

240 
	}
}

255 
	$∑ge_öô
()

274 
size_t
 
i
;

275 
size_t
 
low
 = 
IOPHYSMEM
 / 
PGSIZE
;

276 
size_t
 
t›
 = (
	`PADDR
(
	`boŸ_Æloc
(0))Ë/ 
PGSIZE
;

279 
∑ge_‰ì_li°
 = 
NULL
;

280 
i
 = 0; i < 
≈ages
; i++) {

281 i‡(
i
 =0 || (ò>
low
 && i < 
t›
)){

282 
∑ges
[
i
].
µ_ªf
 = 1;

283 
∑ges
[
i
].
µ_lök
 = 
NULL
;

286 
∑ges
[
i
].
µ_ªf
 = 0;

288 
∑ges
[
i
].
µ_lök
 = 
∑ge_‰ì_li°
;

289 
∑ge_‰ì_li°
 = &
∑ges
[
i
];

291 
	}
}

302 
PageInfo
 *

303 
	$∑ge_Æloc
(
Æloc_Êags
)

306 i‡(
∑ge_‰ì_li°
 !
NULL
) {

307 i‡(
Æloc_Êags
 & 
ALLOC_ZERO
) {

309 
	`mem£t
(
	`∑ge2kva
(
∑ge_‰ì_li°
), 0, 
PGSIZE
);

311 
PageInfo
* 
ãmp
 = 
∑ge_‰ì_li°
;

312 
∑ge_‰ì_li°
 =Öage_‰ì_li°->
µ_lök
;

314  
ãmp
;

316  
NULL
;

317 
	}
}

324 
	$∑ge_‰ì
(
PageInfo
 *
µ
)

327 
µ
->
µ_lök
 = 
∑ge_‰ì_li°
;

328 
∑ge_‰ì_li°
 = 
µ
;

329 
	}
}

336 
	$∑ge_de¸ef
(
PageInfo
* 
µ
)

338 i‡(--
µ
->
µ_ªf
 == 0)

339 
	`∑ge_‰ì
(
µ
);

340 
	}
}

364 
±e_t
 *

365 
	$pgdú_wÆk
(
pde_t
 *
pgdú
, c⁄° *
va
, 
¸óã
)

368 
boﬁ
 
exi°
 = 
Ál£
;

369 
±e_t
 *
±dú
;

370 i‡(
pgdú
[
	`PDX
(
va
)] & 
PTE_P
) {

372 
±dú
 = (
±e_t
*Ë
	`KADDR
(
	`PTE_ADDR
(
pgdú
[
	`PDX
(
va
)]));

375  
±dú
 + 
	`PTX
(
va
);

377 i‡(
¸óã
) {

378 
PageInfo
 * 
ãmp
 = 
	`∑ge_Æloc
(
ALLOC_ZERO
);

379 i‡(
ãmp
 =
NULL
)  NULL;

380 
ãmp
->
µ_ªf
++;

381 
pgdú
[
	`PDX
(
va
)] = 
	`∑ge2∑
(
ãmp
Ë| 
PTE_P
 | 
PTE_U
 | 
PTE_W
;

382 
±dú
 = (
±e_t
*Ë
	`KADDR
(
	`∑ge2∑
(
ãmp
));

383  
±dú
 + 
	`PTX
(
va
);

384 }  
NULL
;

387  
NULL
;

388 
	}
}

401 
	$boŸ_m≠_ªgi⁄
(
pde_t
 *
pgdú
, 
uöçå_t
 
va
, 
size_t
 
size
, 
phyßddr_t
 
∑
, 
≥rm
)

404 
uöçå_t
 
íd
 = 
va
 + 
size
;

405 
±e_t
* 
now
;

406 ;
va
 !
íd
; v®+
PGSIZE
, 
∑
 += PGSIZE) {

407 
now
 = 
	`pgdú_wÆk
(
pgdú
, (*)
va
, 1);

408 i‡(
now
 =
NULL
)

409 
	`∑nic
("stopped");

410 *
now
 = 
	`PTE_ADDR
(
∑
Ë| 
≥rm
 | 
PTE_P
;

412 
	}
}

440 
	$∑ge_ö£π
(
pde_t
 *
pgdú
, 
PageInfo
 *
µ
, *
va
, 
≥rm
)

443 
±e_t
* 
now
 = 
	`pgdú_wÆk
(
pgdú
, 
va
, 0);

444 i‡((
now
 !
NULL
Ë&& (*now & 
PTE_P
)) {

448 i‡(
	`PTE_ADDR
(*
now
Ë=
	`∑ge2∑
(
µ
)) {

449 *
now
 = 
	`PTE_ADDR
(
	`∑ge2∑
(
µ
)Ë| 
≥rm
 | 
PTE_P
;

453 
	`∑ge_ªmove
(
pgdú
, 
va
);

455 i‡(
now
 =
NULL
Ënow = 
	`pgdú_wÆk
(
pgdú
, 
va
, 1);

456 i‡(
now
 =
NULL
Ë -
E_NO_MEM
;

457 *
now
 = 
	`PTE_ADDR
(
	`∑ge2∑
(
µ
)Ë| 
≥rm
 | 
PTE_P
;

458 
µ
->
µ_ªf
++;

460 
	}
}

473 
PageInfo
 *

474 
	$∑ge_lookup
(
pde_t
 *
pgdú
, *
va
, 
±e_t
 **
±e_°‹e
)

477 
±e_t
* 
now
 = 
	`pgdú_wÆk
(
pgdú
, 
va
, 0);

478 i‡(
now
 !
NULL
) {

479 i‡(
±e_°‹e
 !
NULL
) {

480 *
±e_°‹e
 = 
now
;

482  
	`∑2∑ge
(
	`PTE_ADDR
(*
now
));

484  
NULL
;

485 
	}
}

503 
	$∑ge_ªmove
(
pde_t
 *
pgdú
, *
va
)

507 
±e_t
* 
now
;

508 
PageInfo
* 
ãmp
 = 
	`∑ge_lookup
(
pgdú
, 
va
, &
now
);

509 i‡(
ãmp
 !
NULL
) {

511 i‡(*
now
 & 
PTE_P
) {

513 
	`∑ge_de¸ef
(
ãmp
);

517 *
now
 = 0;

520 
	}
}

527 
	$éb_övÆid©e
(
pde_t
 *
pgdú
, *
va
)

531 
	`övÕg
(
va
);

532 
	}
}

534 
uöçå_t
 
	gu£r_mem_check_addr
;

555 
	$u£r_mem_check
(
Env
 *
ív
, c⁄° *
va
, 
size_t
 
Àn
, 
≥rm
)

560 
	}
}

570 
	$u£r_mem_as£π
(
Env
 *
ív
, c⁄° *
va
, 
size_t
 
Àn
, 
≥rm
)

572 i‡(
	`u£r_mem_check
(
ív
, 
va
, 
Àn
, 
≥rm
 | 
PTE_U
) < 0) {

573 
	`˝rötf
("[%08x] user_mem_checkássertion failure for "

574 "v®%08x\n", 
ív
->
ív_id
, 
u£r_mem_check_addr
);

575 
	`ív_de°roy
(
ív
);

577 
	}
}

588 
	$check_∑ge_‰ì_li°
(
boﬁ
 
⁄ly_low_mem‹y
)

590 
PageInfo
 *
µ
;

591 
pdx_limô
 = 
⁄ly_low_mem‹y
 ? 1 : 
NPDENTRIES
;

592 
n‰ì_ba£mem
 = 0, 
n‰ì_extmem
 = 0;

593 *
fú°_‰ì_∑ge
;

595 i‡(!
∑ge_‰ì_li°
)

596 
	`∑nic
("'page_free_list' isáÇullÖointer!");

598 i‡(
⁄ly_low_mem‹y
) {

601 
PageInfo
 *
µ1
, *
µ2
;

602 
PageInfo
 **
ç
[2] = { &
µ1
, &
µ2
 };

603 
µ
 = 
∑ge_‰ì_li°
;Öp;Ö∞µ->
µ_lök
) {

604 
∑gëy≥
 = 
	`PDX
(
	`∑ge2∑
(
µ
)Ë>
pdx_limô
;

605 *
ç
[
∑gëy≥
] = 
µ
;

606 
ç
[
∑gëy≥
] = &
µ
->
µ_lök
;

608 *
ç
[1] = 0;

609 *
ç
[0] = 
µ2
;

610 
∑ge_‰ì_li°
 = 
µ1
;

615 
µ
 = 
∑ge_‰ì_li°
;Öp;Ö∞µ->
µ_lök
)

616 i‡(
	`PDX
(
	`∑ge2∑
(
µ
)Ë< 
pdx_limô
)

617 
	`mem£t
(
	`∑ge2kva
(
µ
), 0x97, 128);

619 
fú°_‰ì_∑ge
 = (*Ë
	`boŸ_Æloc
(0);

620 
µ
 = 
∑ge_‰ì_li°
;Öp;Ö∞µ->
µ_lök
) {

622 
	`as£π
(
µ
 >
∑ges
);

623 
	`as£π
(
µ
 < 
∑ges
 + 
≈ages
);

624 
	`as£π
(((*Ë
µ
 - (*Ë
∑ges
) % (*pp) == 0);

627 
	`as£π
(
	`∑ge2∑
(
µ
) != 0);

628 
	`as£π
(
	`∑ge2∑
(
µ
Ë!
IOPHYSMEM
);

629 
	`as£π
(
	`∑ge2∑
(
µ
Ë!
EXTPHYSMEM
 - 
PGSIZE
);

630 
	`as£π
(
	`∑ge2∑
(
µ
Ë!
EXTPHYSMEM
);

631 
	`as£π
(
	`∑ge2∑
(
µ
Ë< 
EXTPHYSMEM
 || (*Ë
	`∑ge2kva
’pË>
fú°_‰ì_∑ge
);

633 i‡(
	`∑ge2∑
(
µ
Ë< 
EXTPHYSMEM
)

634 ++
n‰ì_ba£mem
;

636 ++
n‰ì_extmem
;

639 
	`as£π
(
n‰ì_ba£mem
 > 0);

640 
	`as£π
(
n‰ì_extmem
 > 0);

641 
	}
}

648 
	$check_∑ge_Æloc
()

650 
PageInfo
 *
µ
, *
µ0
, *
µ1
, *
µ2
;

651 
n‰ì
;

652 
PageInfo
 *
Ê
;

653 *
c
;

654 
i
;

656 i‡(!
∑ges
)

657 
	`∑nic
("'pages' isáÇullÖointer!");

660 
µ
 = 
∑ge_‰ì_li°
, 
n‰ì
 = 0;Öp;Ö∞µ->
µ_lök
)

661 ++
n‰ì
;

664 
µ0
 = 
µ1
 = 
µ2
 = 0;

665 
	`as£π
((
µ0
 = 
	`∑ge_Æloc
(0)));

666 
	`as£π
((
µ1
 = 
	`∑ge_Æloc
(0)));

667 
	`as£π
((
µ2
 = 
	`∑ge_Æloc
(0)));

669 
	`as£π
(
µ0
);

670 
	`as£π
(
µ1
 &&Öp1 !
µ0
);

671 
	`as£π
(
µ2
 &&Öp2 !
µ1
 &&Öp2 !
µ0
);

672 
	`as£π
(
	`∑ge2∑
(
µ0
Ë< 
≈ages
*
PGSIZE
);

673 
	`as£π
(
	`∑ge2∑
(
µ1
Ë< 
≈ages
*
PGSIZE
);

674 
	`as£π
(
	`∑ge2∑
(
µ2
Ë< 
≈ages
*
PGSIZE
);

677 
Ê
 = 
∑ge_‰ì_li°
;

678 
∑ge_‰ì_li°
 = 0;

681 
	`as£π
(!
	`∑ge_Æloc
(0));

684 
	`∑ge_‰ì
(
µ0
);

685 
	`∑ge_‰ì
(
µ1
);

686 
	`∑ge_‰ì
(
µ2
);

687 
µ0
 = 
µ1
 = 
µ2
 = 0;

688 
	`as£π
((
µ0
 = 
	`∑ge_Æloc
(0)));

689 
	`as£π
((
µ1
 = 
	`∑ge_Æloc
(0)));

690 
	`as£π
((
µ2
 = 
	`∑ge_Æloc
(0)));

691 
	`as£π
(
µ0
);

692 
	`as£π
(
µ1
 &&Öp1 !
µ0
);

693 
	`as£π
(
µ2
 &&Öp2 !
µ1
 &&Öp2 !
µ0
);

694 
	`as£π
(!
	`∑ge_Æloc
(0));

697 
	`mem£t
(
	`∑ge2kva
(
µ0
), 1, 
PGSIZE
);

698 
	`∑ge_‰ì
(
µ0
);

699 
	`as£π
((
µ
 = 
	`∑ge_Æloc
(
ALLOC_ZERO
)));

700 
	`as£π
(
µ
 && 
µ0
 ==Öp);

701 
c
 = 
	`∑ge2kva
(
µ
);

702 
i
 = 0; i < 
PGSIZE
; i++)

703 
	`as£π
(
c
[
i
] == 0);

706 
∑ge_‰ì_li°
 = 
Ê
;

709 
	`∑ge_‰ì
(
µ0
);

710 
	`∑ge_‰ì
(
µ1
);

711 
	`∑ge_‰ì
(
µ2
);

714 
µ
 = 
∑ge_‰ì_li°
;Öp;Ö∞µ->
µ_lök
)

715 --
n‰ì
;

716 
	`as£π
(
n‰ì
 == 0);

718 
	`˝rötf
("check_page_alloc() succeeded!\n");

719 
	}
}

730 
	$check_kîn_pgdú
()

732 
uöt32_t
 
i
, 
n
;

733 
pde_t
 *
pgdú
;

735 
pgdú
 = 
kîn_pgdú
;

738 
n
 = 
	`ROUNDUP
(
≈ages
*(
PageInfo
), 
PGSIZE
);

739 
i
 = 0; i < 
n
; i +
PGSIZE
) {

740 
	`as£π
(
	`check_va2∑
(
pgdú
, 
UPAGES
 + 
i
Ë=
	`PADDR
(
∑ges
) + i);

744 
n
 = 
	`ROUNDUP
(
NENV
*(
Env
), 
PGSIZE
);

745 
i
 = 0; i < 
n
; i +
PGSIZE
)

746 
	`as£π
(
	`check_va2∑
(
pgdú
, 
UENVS
 + 
i
Ë=
	`PADDR
(
ívs
) + i);

749 
i
 = 0; i < 
≈ages
 * 
PGSIZE
; i += PGSIZE)

750 
	`as£π
(
	`check_va2∑
(
pgdú
, 
KERNBASE
 + 
i
) == i);

753 
i
 = 0; i < 
KSTKSIZE
; i +
PGSIZE
)

754 
	`as£π
(
	`check_va2∑
(
pgdú
, 
KSTACKTOP
 - 
KSTKSIZE
 + 
i
Ë=
	`PADDR
(
boŸ°ack
) + i);

755 
	`as£π
(
	`check_va2∑
(
pgdú
, 
KSTACKTOP
 - 
PTSIZE
) == ~0);

758 
i
 = 0; i < 
NPDENTRIES
; i++) {

759 
i
) {

760 
	`PDX
(
UVPT
):

761 
	`PDX
(
KSTACKTOP
-1):

762 
	`PDX
(
UPAGES
):

763 
	`PDX
(
UENVS
):

764 
	`as£π
(
pgdú
[
i
] & 
PTE_P
);

767 i‡(
i
 >
	`PDX
(
KERNBASE
)) {

768 
	`as£π
(
pgdú
[
i
] & 
PTE_P
);

769 
	`as£π
(
pgdú
[
i
] & 
PTE_W
);

771 
	`as£π
(
pgdú
[
i
] == 0);

775 
	`˝rötf
("check_kern_pgdir() succeeded!\n");

776 
	}
}

783 
phyßddr_t


784 
	$check_va2∑
(
pde_t
 *
pgdú
, 
uöçå_t
 
va
)

787 
±e_t
 *
p
;

789 
pgdú
 = &pgdú[
	`PDX
(
va
)];

790 i‡(!(*
pgdú
 & 
PTE_P
))

793 
p
 = (
±e_t
*Ë
	`KADDR
(
	`PTE_ADDR
(*
pgdú
));

794 i‡(!(
p
[
	`PTX
(
va
)] & 
PTE_P
))

796  
	`PTE_ADDR
(
p
[
	`PTX
(
va
)]);

797 
	}
}

802 
	$check_∑ge
()

804 
PageInfo
 *
µ
, *
µ0
, *
µ1
, *
µ2
;

805 
PageInfo
 *
Ê
;

806 
±e_t
 *
±ï
, *
±ï1
;

807 *
va
;

808 
i
;

809 
pde_t
 
íåy_pgdú
[];

812 
µ0
 = 
µ1
 = 
µ2
 = 0;

813 
	`as£π
((
µ0
 = 
	`∑ge_Æloc
(0)));

814 
	`as£π
((
µ1
 = 
	`∑ge_Æloc
(0)));

815 
	`as£π
((
µ2
 = 
	`∑ge_Æloc
(0)));

817 
	`as£π
(
µ0
);

818 
	`as£π
(
µ1
 &&Öp1 !
µ0
);

819 
	`as£π
(
µ2
 &&Öp2 !
µ1
 &&Öp2 !
µ0
);

822 
Ê
 = 
∑ge_‰ì_li°
;

823 
∑ge_‰ì_li°
 = 0;

826 
	`as£π
(!
	`∑ge_Æloc
(0));

829 
	`as£π
(
	`∑ge_lookup
(
kîn_pgdú
, (*Ë0x0, &
±ï
Ë=
NULL
);

832 
	`as£π
(
	`∑ge_ö£π
(
kîn_pgdú
, 
µ1
, 0x0, 
PTE_W
) < 0);

835 
	`∑ge_‰ì
(
µ0
);

836 
	`as£π
(
	`∑ge_ö£π
(
kîn_pgdú
, 
µ1
, 0x0, 
PTE_W
) == 0);

837 
	`as£π
(
	`PTE_ADDR
(
kîn_pgdú
[0]Ë=
	`∑ge2∑
(
µ0
));

838 
	`as£π
(
	`check_va2∑
(
kîn_pgdú
, 0x0Ë=
	`∑ge2∑
(
µ1
));

839 
	`as£π
(
µ1
->
µ_ªf
 == 1);

840 
	`as£π
(
µ0
->
µ_ªf
 == 1);

843 
	`as£π
(
	`∑ge_ö£π
(
kîn_pgdú
, 
µ2
, (*Ë
PGSIZE
, 
PTE_W
) == 0);

844 
	`as£π
(
	`check_va2∑
(
kîn_pgdú
, 
PGSIZE
Ë=
	`∑ge2∑
(
µ2
));

845 
	`as£π
(
µ2
->
µ_ªf
 == 1);

848 
	`as£π
(!
	`∑ge_Æloc
(0));

851 
	`as£π
(
	`∑ge_ö£π
(
kîn_pgdú
, 
µ2
, (*Ë
PGSIZE
, 
PTE_W
) == 0);

852 
	`as£π
(
	`check_va2∑
(
kîn_pgdú
, 
PGSIZE
Ë=
	`∑ge2∑
(
µ2
));

853 
	`as£π
(
µ2
->
µ_ªf
 == 1);

857 
	`as£π
(!
	`∑ge_Æloc
(0));

860 
±ï
 = (
±e_t
 *Ë
	`KADDR
(
	`PTE_ADDR
(
kîn_pgdú
[
	`PDX
(
PGSIZE
)]));

861 
	`as£π
(
	`pgdú_wÆk
(
kîn_pgdú
, (*)
PGSIZE
, 0Ë=
±ï
+
	`PTX
(PGSIZE));

864 
	`as£π
(
	`∑ge_ö£π
(
kîn_pgdú
, 
µ2
, (*Ë
PGSIZE
, 
PTE_W
|
PTE_U
) == 0);

865 
	`as£π
(
	`check_va2∑
(
kîn_pgdú
, 
PGSIZE
Ë=
	`∑ge2∑
(
µ2
));

866 
	`as£π
(
µ2
->
µ_ªf
 == 1);

868 
	`as£π
(*
	`pgdú_wÆk
(
kîn_pgdú
, (*Ë
PGSIZE
, 0Ë& 
PTE_U
);

869 
	`as£π
(
kîn_pgdú
[0] & 
PTE_U
);

872 
	`as£π
(
	`∑ge_ö£π
(
kîn_pgdú
, 
µ2
, (*Ë
PGSIZE
, 
PTE_W
) == 0);

873 
	`as£π
(*
	`pgdú_wÆk
(
kîn_pgdú
, (*Ë
PGSIZE
, 0Ë& 
PTE_W
);

874 
	`as£π
(!(*
	`pgdú_wÆk
(
kîn_pgdú
, (*Ë
PGSIZE
, 0Ë& 
PTE_U
));

877 
	`as£π
(
	`∑ge_ö£π
(
kîn_pgdú
, 
µ0
, (*Ë
PTSIZE
, 
PTE_W
) < 0);

881 
	`as£π
(
	`∑ge_ö£π
(
kîn_pgdú
, 
µ1
, (*Ë
PGSIZE
, 
PTE_W
) == 0);

882 
	`as£π
(!(*
	`pgdú_wÆk
(
kîn_pgdú
, (*Ë
PGSIZE
, 0Ë& 
PTE_U
));

885 
	`as£π
(
	`check_va2∑
(
kîn_pgdú
, 0Ë=
	`∑ge2∑
(
µ1
));

886 
	`as£π
(
	`check_va2∑
(
kîn_pgdú
, 
PGSIZE
Ë=
	`∑ge2∑
(
µ1
));

889 
	`as£π
(
µ1
->
µ_ªf
 == 2);

890 
	`as£π
(
µ2
->
µ_ªf
 == 0);

893 
	`as£π
((
µ
 = 
	`∑ge_Æloc
(0)Ë&&Ö∞=
µ2
);

896 
	`∑ge_ªmove
(
kîn_pgdú
, 0x0);

898 
	`as£π
(
	`check_va2∑
(
kîn_pgdú
, 0x0) == ~0);

899 
	`as£π
(
	`check_va2∑
(
kîn_pgdú
, 
PGSIZE
Ë=
	`∑ge2∑
(
µ1
));

900 
	`as£π
(
µ1
->
µ_ªf
 == 1);

901 
	`as£π
(
µ2
->
µ_ªf
 == 0);

904 
	`∑ge_ªmove
(
kîn_pgdú
, (*Ë
PGSIZE
);

905 
	`as£π
(
	`check_va2∑
(
kîn_pgdú
, 0x0) == ~0);

906 
	`as£π
(
	`check_va2∑
(
kîn_pgdú
, 
PGSIZE
) == ~0);

907 
	`as£π
(
µ1
->
µ_ªf
 == 0);

908 
	`as£π
(
µ2
->
µ_ªf
 == 0);

911 
	`as£π
((
µ
 = 
	`∑ge_Æloc
(0)Ë&&Ö∞=
µ1
);

914 
	`as£π
(!
	`∑ge_Æloc
(0));

917 
	`as£π
(
	`PTE_ADDR
(
kîn_pgdú
[0]Ë=
	`∑ge2∑
(
µ0
));

918 
kîn_pgdú
[0] = 0;

919 
	`as£π
(
µ0
->
µ_ªf
 == 1);

920 
µ0
->
µ_ªf
 = 0;

923 
	`∑ge_‰ì
(
µ0
);

924 
va
 = (*)(
PGSIZE
 * 
NPDENTRIES
 + PGSIZE);

925 
±ï
 = 
	`pgdú_wÆk
(
kîn_pgdú
, 
va
, 1);

926 
±ï1
 = (
±e_t
 *Ë
	`KADDR
(
	`PTE_ADDR
(
kîn_pgdú
[
	`PDX
(
va
)]));

927 
	`as£π
(
±ï
 =
±ï1
 + 
	`PTX
(
va
));

928 
kîn_pgdú
[
	`PDX
(
va
)] = 0;

929 
µ0
->
µ_ªf
 = 0;

932 
	`mem£t
(
	`∑ge2kva
(
µ0
), 0xFF, 
PGSIZE
);

933 
	`∑ge_‰ì
(
µ0
);

934 
	`pgdú_wÆk
(
kîn_pgdú
, 0x0, 1);

935 
±ï
 = (
±e_t
 *Ë
	`∑ge2kva
(
µ0
);

936 
i
=0; i<
NPTENTRIES
; i++)

937 
	`as£π
((
±ï
[
i
] & 
PTE_P
) == 0);

938 
kîn_pgdú
[0] = 0;

939 
µ0
->
µ_ªf
 = 0;

942 
∑ge_‰ì_li°
 = 
Ê
;

945 
	`∑ge_‰ì
(
µ0
);

946 
	`∑ge_‰ì
(
µ1
);

947 
	`∑ge_‰ì
(
µ2
);

949 
	`˝rötf
("check_page() succeeded!\n");

950 
	}
}

954 
	$check_∑ge_ö°ÆÀd_pgdú
()

956 
PageInfo
 *
µ
, *
µ0
, *
µ1
, *
µ2
;

957 
PageInfo
 *
Ê
;

958 
±e_t
 *
±ï
, *
±ï1
;

959 
uöçå_t
 
va
;

960 
i
;

963 
µ1
 = 
µ2
 = 0;

964 
	`as£π
((
µ0
 = 
	`∑ge_Æloc
(0)));

965 
	`as£π
((
µ1
 = 
	`∑ge_Æloc
(0)));

966 
	`as£π
((
µ2
 = 
	`∑ge_Æloc
(0)));

967 
	`∑ge_‰ì
(
µ0
);

968 
	`mem£t
(
	`∑ge2kva
(
µ1
), 1, 
PGSIZE
);

969 
	`mem£t
(
	`∑ge2kva
(
µ2
), 2, 
PGSIZE
);

970 
	`∑ge_ö£π
(
kîn_pgdú
, 
µ1
, (*Ë
PGSIZE
, 
PTE_W
);

971 
	`as£π
(
µ1
->
µ_ªf
 == 1);

972 
	`as£π
(*(
uöt32_t
 *)
PGSIZE
 == 0x01010101U);

973 
	`∑ge_ö£π
(
kîn_pgdú
, 
µ2
, (*Ë
PGSIZE
, 
PTE_W
);

974 
	`as£π
(*(
uöt32_t
 *)
PGSIZE
 == 0x02020202U);

975 
	`as£π
(
µ2
->
µ_ªf
 == 1);

976 
	`as£π
(
µ1
->
µ_ªf
 == 0);

977 *(
uöt32_t
 *)
PGSIZE
 = 0x03030303U;

978 
	`as£π
(*(
uöt32_t
 *)
	`∑ge2kva
(
µ2
) == 0x03030303U);

979 
	`∑ge_ªmove
(
kîn_pgdú
, (*Ë
PGSIZE
);

980 
	`as£π
(
µ2
->
µ_ªf
 == 0);

983 
	`as£π
(
	`PTE_ADDR
(
kîn_pgdú
[0]Ë=
	`∑ge2∑
(
µ0
));

984 
kîn_pgdú
[0] = 0;

985 
	`as£π
(
µ0
->
µ_ªf
 == 1);

986 
µ0
->
µ_ªf
 = 0;

989 
	`∑ge_‰ì
(
µ0
);

991 
	`˝rötf
("check_page_installed_pgdir() succeeded!\n");

992 
	}
}

	@pmap.h

3 #i‚de‡
JOS_KERN_PMAP_H


4 
	#JOS_KERN_PMAP_H


	)

5 #i‚de‡
JOS_KERNEL


9 
	~<öc/memœyout.h
>

10 
	~<öc/as£π.h
>

11 
	gEnv
;

13 
boŸ°ackt›
[], 
boŸ°ack
[];

15 
PageInfo
 *
∑ges
;

16 
size_t
 
≈ages
;

18 
pde_t
 *
kîn_pgdú
;

26 
	#PADDR
(
kva
Ë
	`_∑ddr
(
__FILE__
, 
__LINE__
, kva)

	)

28 
ölöe
 
phyßddr_t


29 
	$_∑ddr
(c⁄° *
fûe
, 
löe
, *
kva
)

31 i‡((
uöt32_t
)
kva
 < 
KERNBASE
)

32 
	`_∑nic
(
fûe
, 
löe
, "PADDR cÆÀd wôh invÆid kv®%08lx", 
kva
);

33  (
phyßddr_t
)
kva
 - 
KERNBASE
;

34 
	}
}

38 
	#KADDR
(
∑
Ë
	`_kaddr
(
__FILE__
, 
__LINE__
,Öa)

	)

40 
ölöe
 *

41 
	$_kaddr
(c⁄° *
fûe
, 
löe
, 
phyßddr_t
 
∑
)

43 i‡(
	`PGNUM
(
∑
Ë>
≈ages
)

44 
	`_∑nic
(
fûe
, 
löe
, "KADDR cÆÀd wôh invÆidÖ®%08lx", 
∑
);

45  (*)(
∑
 + 
KERNBASE
);

46 
	}
}

51 
	mALLOC_ZERO
 = 1<<0,

54 
mem_öô
();

56 
∑ge_öô
();

57 
PageInfo
 *
∑ge_Æloc
(
Æloc_Êags
);

58 
∑ge_‰ì
(
PageInfo
 *
µ
);

59 
∑ge_ö£π
(
pde_t
 *
pgdú
, 
PageInfo
 *
µ
, *
va
, 
≥rm
);

60 
∑ge_ªmove
(
pde_t
 *
pgdú
, *
va
);

61 
PageInfo
 *
∑ge_lookup
(
pde_t
 *
pgdú
, *
va
, 
±e_t
 **
±e_°‹e
);

62 
∑ge_de¸ef
(
PageInfo
 *
µ
);

64 
éb_övÆid©e
(
pde_t
 *
pgdú
, *
va
);

66 
u£r_mem_check
(
Env
 *
ív
, c⁄° *
va
, 
size_t
 
Àn
, 
≥rm
);

67 
u£r_mem_as£π
(
Env
 *
ív
, c⁄° *
va
, 
size_t
 
Àn
, 
≥rm
);

69 
ölöe
 
phyßddr_t


70 
	$∑ge2∑
(
PageInfo
 *
µ
)

72  (
µ
 - 
∑ges
Ë<< 
PGSHIFT
;

73 
	}
}

75 
ölöe
 
PageInfo
*

76 
	$∑2∑ge
(
phyßddr_t
 
∑
)

78 i‡(
	`PGNUM
(
∑
Ë>
≈ages
)

79 
	`∑nic
("pa2page called with invalidÖa");

80  &
∑ges
[
	`PGNUM
(
∑
)];

81 
	}
}

83 
ölöe
 *

84 
	$∑ge2kva
(
PageInfo
 *
µ
)

86  
	`KADDR
(
	`∑ge2∑
(
µ
));

87 
	}
}

89 
±e_t
 *
pgdú_wÆk
(
pde_t
 *
pgdú
, c⁄° *
va
, 
¸óã
);

	@printf.c

4 
	~<öc/ty≥s.h
>

5 
	~<öc/°dio.h
>

6 
	~<öc/°d¨g.h
>

10 
	$putch
(
ch
, *
˙t
)

12 
	`˝utch¨
(
ch
);

13 *
˙t
++;

14 
	}
}

17 
	$v˝rötf
(c⁄° *
fmt
, 
va_li°
 
≠
)

19 
˙t
 = 0;

21 
	`v¥ötfmt
((*)
putch
, &
˙t
, 
fmt
, 
≠
);

22  
˙t
;

23 
	}
}

26 
	$˝rötf
(c⁄° *
fmt
, ...)

28 
va_li°
 
≠
;

29 
˙t
;

31 
	`va_°¨t
(
≠
, 
fmt
);

32 
˙t
 = 
	`v˝rötf
(
fmt
, 
≠
);

33 
	`va_íd
(
≠
);

35  
˙t
;

36 
	}
}

	@syscall.c

3 
	~<öc/x86.h
>

4 
	~<öc/îr‹.h
>

5 
	~<öc/°rög.h
>

6 
	~<öc/as£π.h
>

8 
	~<kîn/ív.h
>

9 
	~<kîn/pm≠.h
>

10 
	~<kîn/å≠.h
>

11 
	~<kîn/sysˇŒ.h
>

12 
	~<kîn/c⁄sﬁe.h
>

18 
	$sys_˝uts
(c⁄° *
s
, 
size_t
 
Àn
)

26 
	`˝rötf
("%.*s", 
Àn
, 
s
);

27 
	}
}

32 
	$sys_cgëc
()

34  
	`c⁄s_gëc
();

35 
	}
}

38 
ívid_t


39 
	$sys_gëívid
()

41  
cuªnv
->
ív_id
;

42 
	}
}

50 
	$sys_ív_de°roy
(
ívid_t
 
ívid
)

52 
r
;

53 
Env
 *
e
;

55 i‡((
r
 = 
	`ívid2ív
(
ívid
, &
e
, 1)) < 0)

56  
r
;

57 i‡(
e
 =
cuªnv
)

58 
	`˝rötf
("[%08x]Éxôög gø˚fuŒy\n", 
cuªnv
->
ív_id
);

60 
	`˝rötf
("[%08x] de°royög %08x\n", 
cuªnv
->
ív_id
, 
e
->env_id);

61 
	`ív_de°roy
(
e
);

63 
	}
}

66 
öt32_t


67 
	$sysˇŒ
(
uöt32_t
 
sysˇŒno
, uöt32_à
a1
, uöt32_à
a2
, uöt32_à
a3
, uöt32_à
a4
, uöt32_à
a5
)

73 
	`∑nic
("syscallÇot implemented");

74 
	}
}

	@syscall.h

1 #i‚de‡
JOS_KERN_SYSCALL_H


2 
	#JOS_KERN_SYSCALL_H


	)

3 #i‚de‡
JOS_KERNEL


7 
	~<öc/sysˇŒ.h
>

9 
öt32_t
 
sysˇŒ
(
uöt32_t
 
num
, uöt32_à
a1
, uöt32_à
a2
, uöt32_à
a3
, uöt32_à
a4
, uöt32_à
a5
);

	@trap.c

1 
	~<öc/mmu.h
>

2 
	~<öc/x86.h
>

3 
	~<öc/as£π.h
>

5 
	~<kîn/pm≠.h
>

6 
	~<kîn/å≠.h
>

7 
	~<kîn/c⁄sﬁe.h
>

8 
	~<kîn/m⁄ô‹.h
>

9 
	~<kîn/ív.h
>

10 
	~<kîn/sysˇŒ.h
>

12 
Task°©e
 
	gts
;

18 
Tøp‰ame
 *
	gœ°_tf
;

23 
G©edesc
 
	gidt
[256] = { { 0 } };

24 
P£udodesc
 
	gidt_pd
 = {

25 (
idt
Ë- 1, (
uöt32_t
) idt

29 c⁄° *
	$å≠«me
(
å≠no
)

31 c⁄° * c⁄° 
ex˙ames
[] = {

54 i‡(
å≠no
 < (
ex˙ames
)/(excnames[0]))

55  
ex˙ames
[
å≠no
];

56 i‡(
å≠no
 =
T_SYSCALL
)

59 
	}
}

63 
	$å≠_öô
()

65 
Segdesc
 
gdt
[];

70 
	`å≠_öô_≥r˝u
();

71 
	}
}

75 
	$å≠_öô_≥r˝u
()

79 
ts
.
ts_e•0
 = 
KSTACKTOP
;

80 
ts
.
ts_ss0
 = 
GD_KD
;

83 
gdt
[
GD_TSS0
 >> 3] = 
	`SEG16
(
STS_T32A
, (
uöt32_t
Ë(&
ts
),

84 (
Task°©e
), 0);

85 
gdt
[
GD_TSS0
 >> 3].
sd_s
 = 0;

89 
	`…r
(
GD_TSS0
);

92 
	`lidt
(&
idt_pd
);

93 
	}
}

96 
	$¥öt_å≠‰ame
(
Tøp‰ame
 *
tf
)

98 
	`˝rötf
("TRAP fømê© %p\n", 
tf
);

99 
	`¥öt_ªgs
(&
tf
->
tf_ªgs
);

100 
	`˝rötf
("É† 0x----%04x\n", 
tf
->
tf_es
);

101 
	`˝rötf
(" d† 0x----%04x\n", 
tf
->
tf_ds
);

102 
	`˝rötf
("Åø∞0x%08x %s\n", 
tf
->
tf_å≠no
, 
	`å≠«me
(tf->tf_trapno));

105 i‡(
tf
 =
œ°_tf
 &&Åf->
tf_å≠no
 =
T_PGFLT
)

106 
	`˝rötf
(" cr2 0x%08x\n", 
	`r¸2
());

107 
	`˝rötf
("Éº 0x%08x", 
tf
->
tf_îr
);

112 i‡(
tf
->
tf_å≠no
 =
T_PGFLT
)

113 
	`˝rötf
(" [%s, %s, %s]\n",

114 
tf
->
tf_îr
 & 4 ? "user" : "kernel",

115 
tf
->
tf_îr
 & 2 ? "write" : "read",

116 
tf
->
tf_îr
 & 1 ? "protection" : "not-present");

118 
	`˝rötf
("\n");

119 
	`˝rötf
("Éù 0x%08x\n", 
tf
->
tf_eù
);

120 
	`˝rötf
(" c† 0x----%04x\n", 
tf
->
tf_cs
);

121 
	`˝rötf
(" fœg 0x%08x\n", 
tf
->
tf_eÊags
);

122 i‡((
tf
->
tf_cs
 & 3) != 0) {

123 
	`˝rötf
("É• 0x%08x\n", 
tf
->
tf_e•
);

124 
	`˝rötf
(" s† 0x----%04x\n", 
tf
->
tf_ss
);

126 
	}
}

129 
	$¥öt_ªgs
(
PushRegs
 *
ªgs
)

131 
	`˝rötf
("Édò 0x%08x\n", 
ªgs
->
ªg_edi
);

132 
	`˝rötf
("Ésò 0x%08x\n", 
ªgs
->
ªg_esi
);

133 
	`˝rötf
("Éb∞ 0x%08x\n", 
ªgs
->
ªg_ebp
);

134 
	`˝rötf
(" oe• 0x%08x\n", 
ªgs
->
ªg_€•
);

135 
	`˝rötf
("Ébx 0x%08x\n", 
ªgs
->
ªg_ebx
);

136 
	`˝rötf
("Édx 0x%08x\n", 
ªgs
->
ªg_edx
);

137 
	`˝rötf
("Écx 0x%08x\n", 
ªgs
->
ªg_ecx
);

138 
	`˝rötf
("Éax 0x%08x\n", 
ªgs
->
ªg_óx
);

139 
	}
}

142 
	$å≠_di•©ch
(
Tøp‰ame
 *
tf
)

148 
	`¥öt_å≠‰ame
(
tf
);

149 i‡(
tf
->
tf_cs
 =
GD_KT
)

150 
	`∑nic
("unhandledÅrap in kernel");

152 
	`ív_de°roy
(
cuªnv
);

155 
	}
}

158 
	$å≠
(
Tøp‰ame
 *
tf
)

162 
asm
 volatile("cld" ::: "cc");

167 
	`as£π
(!(
	`ªad_eÊags
(Ë& 
FL_IF
));

169 
	`˝rötf
("Incomög TRAP fømê© %p\n", 
tf
);

171 i‡((
tf
->
tf_cs
 & 3) == 3) {

173 
	`as£π
(
cuªnv
);

178 
cuªnv
->
ív_tf
 = *
tf
;

180 
tf
 = &
cuªnv
->
ív_tf
;

185 
œ°_tf
 = 
tf
;

188 
	`å≠_di•©ch
(
tf
);

191 
	`as£π
(
cuªnv
 && cuªnv->
ív_°©us
 =
ENV_RUNNING
);

192 
	`ív_run
(
cuªnv
);

193 
	}
}

197 
	$∑ge_Áu…_h™dÀr
(
Tøp‰ame
 *
tf
)

199 
uöt32_t
 
Áu…_va
;

202 
Áu…_va
 = 
	`r¸2
();

212 
	`˝rötf
("[%08x] user fault va %08x ip %08x\n",

213 
cuªnv
->
ív_id
, 
Áu…_va
, 
tf
->
tf_eù
);

214 
	`¥öt_å≠‰ame
(
tf
);

215 
	`ív_de°roy
(
cuªnv
);

216 
	}
}

	@trap.h

3 #i‚de‡
JOS_KERN_TRAP_H


4 
	#JOS_KERN_TRAP_H


	)

5 #i‚de‡
JOS_KERNEL


9 
	~<öc/å≠.h
>

10 
	~<öc/mmu.h
>

13 
G©edesc
 
idt
[];

14 
P£udodesc
 
idt_pd
;

16 
å≠_öô
();

17 
å≠_öô_≥r˝u
();

18 
¥öt_ªgs
(
PushRegs
 *
ªgs
);

19 
¥öt_å≠‰ame
(
Tøp‰ame
 *
tf
);

20 
∑ge_Áu…_h™dÀr
(
Tøp‰ame
 *);

21 
backåa˚
(
Tøp‰ame
 *);

	@
1
.
1
/usr/include
20
174
console.c
console.h
entrypgdir.c
env.c
env.h
init.c
kclock.c
kclock.h
kdebug.c
kdebug.h
kernel.h
monitor.c
monitor.h
pmap.c
pmap.h
printf.c
syscall.c
syscall.h
trap.c
trap.h
